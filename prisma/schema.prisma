generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_DATABASE_URL")
}

model achievements {
  id              String          @id
  freeUserId      String
  type            AchievementType
  title           String
  description     String
  icon            String?
  points          Int             @default(0)
  currentProgress Int             @default(0)
  targetProgress  Int             @default(1)
  isCompleted     Boolean         @default(false)
  earnedAt        DateTime?
  createdAt       DateTime        @default(now())
  free_users      free_users      @relation(fields: [freeUserId], references: [id], onDelete: Cascade)
}

model activities {
  id          String   @id
  userId      String
  leadId      String?
  action      String
  description String
  metadata    Json?
  createdAt   DateTime @default(now())
  leads       leads?   @relation(fields: [leadId], references: [id], onDelete: Cascade)
  users       users    @relation(fields: [userId], references: [id])

  @@index([createdAt])
  @@index([leadId])
  @@index([userId, createdAt])
}

model analytics_events {
  id          String   @id
  userId      String?
  sessionId   String?
  eventType   String
  eventName   String
  properties  Json?
  pagePath    String?
  pageTitle   String?
  referrer    String?
  userAgent   String?
  utmSource   String?
  utmMedium   String?
  utmCampaign String?
  ipAddress   String?
  country     String?
  city        String?
  createdAt   DateTime @default(now())

  @@index([eventType, createdAt])
  @@index([userId, createdAt])
  @@index([sessionId])
  @@index([utmSource, utmMedium, utmCampaign])
}

model biology_topics {
  id              String          @id
  title           String
  slug            String          @unique
  content         String
  excerpt         String?
  metaTitle       String?
  metaDescription String?
  keywords        String[]
  curriculum      String
  grade           String
  chapter         String
  difficulty      String          @default("Medium")
  keyPoints       Json?
  diagrams        Json?
  videoUrl        String?
  leadMagnetId    String?
  viewCount       Int             @default(0)
  leadConversions Int             @default(0)
  avgTimeOnPage   Int?
  bounceRate      Float?
  isPublished     Boolean         @default(false)
  publishedAt     DateTime?
  authorName      String?         @default("Dr. Shekhar C Singh")
  createdAt       DateTime        @default(now())
  updatedAt       DateTime
  lead_magnets    lead_magnets?   @relation(fields: [leadMagnetId], references: [id])
  content_leads   content_leads[]

  @@index([curriculum, grade, chapter])
  @@index([isPublished, publishedAt])
  @@index([slug])
  @@index([viewCount])
}

model bookmarks {
  id            String        @id
  freeUserId    String
  chapterNoteId String
  notes         String?
  createdAt     DateTime      @default(now())
  chapter_notes chapter_notes @relation(fields: [chapterNoteId], references: [id], onDelete: Cascade)
  free_users    free_users    @relation(fields: [freeUserId], references: [id], onDelete: Cascade)

  @@unique([freeUserId, chapterNoteId])
}

model chapter_notes {
  id              String      @id
  title           String
  curriculum      String
  grade           String
  subject         String      @default("Biology")
  chapter         String
  topic           String?
  content         String
  summary         String?
  keyPoints       Json?
  diagrams        Json?
  difficulty      String      @default("Medium")
  estimatedTime   Int?
  downloadCount   Int         @default(0)
  viewCount       Int         @default(0)
  rating          Float       @default(0)
  ratingCount     Int         @default(0)
  slug            String      @unique
  metaDescription String?
  tags            Json?
  isPublished     Boolean     @default(false)
  publishedAt     DateTime?
  createdAt       DateTime    @default(now())
  updatedAt       DateTime
  bookmarks       bookmarks[]

  @@index([curriculum, grade, chapter])
  @@index([slug])
}

model chapters {
  id              String            @id
  courseId        String
  title           String
  description     String?
  orderIndex      Int
  isActive        Boolean           @default(true)
  createdAt       DateTime          @default(now())
  updatedAt       DateTime
  assignments     assignments[]
  courses         courses           @relation(fields: [courseId], references: [id], onDelete: Cascade)
  doubt_tickets   doubt_tickets[]
  study_materials study_materials[]
  topics          topics[]

  @@index([courseId, orderIndex])
}

model chat_history {
  id              String   @id
  userId          String?
  freeUserId      String?
  sessionId       String
  message         String
  isUserMessage   Boolean
  ncertReferences Json?
  relatedTopics   Json?
  confidence      Int?
  tokensUsed      Int?
  topic           String?
  difficulty      String?
  createdAt       DateTime @default(now())

  @@index([freeUserId, createdAt])
  @@index([sessionId, createdAt])
  @@index([userId, createdAt])
}

model communication_logs {
  id                String               @id
  userId            String?
  demoBookingId     String?
  type              CommunicationType
  channel           CommunicationChannel
  content           String
  subject           String?
  status            MessageStatus        @default(SENT)
  sentAt            DateTime             @default(now())
  deliveredAt       DateTime?
  readAt            DateTime?
  whatsappMessageId String?
  emailMessageId    String?
  templateId        String?
  templateData      Json?
  createdAt         DateTime             @default(now())
  demo_bookings     demo_bookings?       @relation(fields: [demoBookingId], references: [id])
  users             users?               @relation(fields: [userId], references: [id])
}

model content_leads {
  id                  String          @id
  email               String?
  whatsappNumber      String?
  name                String?
  grade               String?
  interestedIn        String?
  source              String
  topicSlug           String?
  leadMagnetId        String?
  utmSource           String?
  utmMedium           String?
  utmCampaign         String?
  utmContent          String?
  utmTerm             String?
  referrerUrl         String?
  landingPage         String?
  deviceType          String?
  browser             String?
  ipAddress           String?
  country             String?
  city                String?
  downloadCompleted   Boolean         @default(false)
  downloadedAt        DateTime?
  emailVerified       Boolean         @default(false)
  whatsappVerified    Boolean         @default(false)
  convertedToPaid     Boolean         @default(false)
  convertedAt         DateTime?
  enrollmentId        String?
  welcomeEmailSent    Boolean         @default(false)
  welcomeWhatsAppSent Boolean         @default(false)
  followUpCount       Int             @default(0)
  lastContactedAt     DateTime?
  leadScore           Int             @default(0)
  leadStage           String          @default("NEW")
  createdAt           DateTime        @default(now())
  updatedAt           DateTime
  lead_magnets        lead_magnets?   @relation(fields: [leadMagnetId], references: [id])
  biology_topics      biology_topics? @relation(fields: [topicSlug], references: [slug])

  @@index([convertedToPaid])
  @@index([createdAt])
  @@index([email])
  @@index([leadStage, leadScore])
  @@index([source, createdAt])
  @@index([topicSlug, createdAt])
  @@index([whatsappNumber])
}

model content_notifications {
  id              String             @id
  title           String
  message         String
  type            NotificationType
  targetUserIds   Json?
  targetCourseIds Json?
  sendToAll       Boolean            @default(false)
  materialId      String?
  courseId        String?
  channels        Json
  scheduledFor    DateTime?
  sentAt          DateTime?
  status          NotificationStatus @default(DRAFT)
  recipientCount  Int                @default(0)
  deliveredCount  Int                @default(0)
  failedCount     Int                @default(0)
  createdAt       DateTime           @default(now())
  updatedAt       DateTime

  @@index([materialId])
  @@index([status, scheduledFor])
}

model courses {
  id                      String                    @id
  name                    String
  description             String?
  type                    CourseType
  class                   StudentClass
  duration                Int
  totalFees               Int
  syllabus                Json?
  features                Json?
  isActive                Boolean                   @default(true)
  sortOrder               Int                       @default(0)
  createdAt               DateTime                  @default(now())
  updatedAt               DateTime
  assignments             assignments[]
  attendance_settings     attendance_settings?
  certificates            certificates[]
  chapters                chapters[]
  class_sessions          class_sessions[]
  demo_bookings           demo_bookings[]
  doubt_tickets           doubt_tickets[]
  enrollments             enrollments[]
  product_recommendations product_recommendations[]
  study_materials         study_materials[]

  @@index([isActive, sortOrder])
  @@index([type, isActive])
  @@index([class, isActive])
}

model product_recommendations {
  id              String    @id @default(cuid())
  leadId          String?
  userId          String?
  courseId        String
  matchScore      Int
  matchReasons    Json
  offerSuggestion Json?
  recommendedAt   DateTime  @default(now())
  viewedAt        DateTime?
  clickedAt       DateTime?
  convertedAt     DateTime?
  source          String    @default("AGENT")
  metadata        Json?
  createdAt       DateTime  @default(now())
  course          courses   @relation(fields: [courseId], references: [id], onDelete: Cascade)
  lead            leads?    @relation(fields: [leadId], references: [id], onDelete: Cascade)
  user            users?    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([leadId])
  @@index([userId])
  @@index([courseId])
  @@index([recommendedAt])
}

model crm_communications {
  id                String        @id
  leadId            String
  type              CommType
  direction         Direction
  subject           String?
  message           String
  status            CommStatus    @default(PENDING)
  sentById          String
  sentAt            DateTime      @default(now())
  whatsappMessageId String?
  templateName      String?
  callDuration      Int?
  callRecordingUrl  String?
  attachments       String[]
  actionItems       String[]
  callSummary       String?
  callTranscript    String?
  keyTopics         String[]
  sentiment         String?
  summarizedAt      DateTime?
  transcribedAt     DateTime?
  agent_tasks       agent_tasks[]
  leads             leads         @relation(fields: [leadId], references: [id], onDelete: Cascade)
  users             users         @relation(fields: [sentById], references: [id])

  @@index([leadId, sentAt])
  @@index([sentById])
}

model demo_bookings {
  id                    String               @id
  userId                String?
  courseId              String?
  studentName           String
  email                 String?
  phone                 String
  studentClass          StudentClass?
  preferredDate         String
  preferredTime         String
  message               String?
  status                DemoBookingStatus    @default(PENDING)
  assignedTo            String?
  followUpDate          DateTime?
  remindersSent         Int                  @default(0)
  demoCompleted         Boolean              @default(false)
  demoRating            Int?
  demoFeedback          String?
  convertedToEnrollment Boolean              @default(false)
  source                String?
  utmSource             String?
  utmMedium             String?
  utmCampaign           String?
  createdAt             DateTime             @default(now())
  updatedAt             DateTime
  demoType              DemoType             @default(FREE)
  paymentAmount         Int?
  paymentCompletedAt    DateTime?
  paymentStatus         DemoPaymentStatus    @default(NOT_REQUIRED)
  razorpayOrderId       String?              @unique
  razorpayPaymentId     String?              @unique
  referralCodeUsed      String?
  referralDiscount      Int?
  notificationsSent     Json?                @default("{\"email\": false, \"whatsapp\": false}")
  communication_logs    communication_logs[]
  courses               courses?             @relation(fields: [courseId], references: [id])
  users                 users?               @relation(fields: [userId], references: [id])
  leads                 leads?

  @@index([assignedTo, status])
  @@index([email])
  @@index([phone])
  @@index([preferredDate, status])
  @@index([status, createdAt])
}

model enrollments {
  id                  String               @id
  userId              String
  courseId            String
  status              EnrollmentStatus     @default(PENDING)
  enrollmentDate      DateTime             @default(now())
  startDate           DateTime?
  endDate             DateTime?
  totalFees           Int
  paidAmount          Int                  @default(0)
  pendingAmount       Int                  @default(0)
  paymentPlan         PaymentPlan          @default(FULL)
  currentProgress     Int                  @default(0)
  lastAccessDate      DateTime?
  createdAt           DateTime             @default(now())
  updatedAt           DateTime
  attendance_settings attendance_settings?
  certificates        certificates[]
  class_sessions      class_sessions[]
  courses             courses              @relation(fields: [courseId], references: [id])
  users               users                @relation(fields: [userId], references: [id])
  payments            payments[]
  student_attendance  student_attendance[]
  video_progress      video_progress[]

  @@unique([userId, courseId])
  @@index([courseId, status])
  @@index([enrollmentDate])
  @@index([status, createdAt])
  @@index([userId, status])
}

model fee_payments {
  id                String    @id
  feePlanId         String
  installmentId     String?
  amount            Decimal   @db.Decimal(10, 2)
  paymentMethod     String
  razorpayOrderId   String?
  razorpayPaymentId String?
  razorpaySignature String?
  status            String
  paidAt            DateTime?
  metadata          Json?
  receiptUrl        String?
  createdAt         DateTime  @default(now())
  fee_plans         fee_plans @relation(fields: [feePlanId], references: [id])

  @@index([feePlanId, createdAt])
}

model fee_plans {
  id                   String         @id
  leadId               String
  courseId             String
  courseName           String
  baseFee              Decimal        @db.Decimal(10, 2)
  discount             Decimal        @default(0) @db.Decimal(10, 2)
  discountType         DiscountType   @default(PERCENTAGE)
  totalFee             Decimal        @db.Decimal(10, 2)
  amountPaid           Decimal        @default(0) @db.Decimal(10, 2)
  amountDue            Decimal        @db.Decimal(10, 2)
  planType             String
  numberOfInstallments Int
  status               FeeStatus      @default(PENDING)
  createdById          String
  createdAt            DateTime       @default(now())
  updatedAt            DateTime
  fee_payments         fee_payments[]
  users                users          @relation(fields: [createdById], references: [id])
  leads                leads          @relation(fields: [leadId], references: [id], onDelete: Cascade)
  installments         installments[]

  @@index([createdById])
  @@index([leadId, status])
}

model forum_posts {
  id            String          @id
  freeUserId    String
  title         String
  content       String
  topic         String
  type          PostType        @default(QUESTION)
  upvotes       Int             @default(0)
  views         Int             @default(0)
  isResolved    Boolean         @default(false)
  isPinned      Boolean         @default(false)
  createdAt     DateTime        @default(now())
  updatedAt     DateTime
  free_users    free_users      @relation(fields: [freeUserId], references: [id], onDelete: Cascade)
  forum_replies forum_replies[]

  @@index([topic, createdAt])
}

model forum_replies {
  id          String      @id
  postId      String
  content     String
  authorName  String
  upvotes     Int         @default(0)
  isAccepted  Boolean     @default(false)
  createdAt   DateTime    @default(now())
  forum_posts forum_posts @relation(fields: [postId], references: [id], onDelete: Cascade)
}

model free_users {
  id                      String                    @id
  email                   String                    @unique
  name                    String?
  grade                   String?
  curriculum              String?
  school                  String?
  city                    String?
  totalPoints             Int                       @default(0)
  studyStreak             Int                       @default(0)
  lastActiveDate          DateTime?
  preferences             Json?
  registrationDate        DateTime                  @default(now())
  updatedAt               DateTime
  adaptiveData            Json?
  averageScore            Float?
  bestScore               Float?
  currentLevel            Int                       @default(1)
  strongestTopics         Json?
  totalTestsTaken         Int                       @default(0)
  weakestTopics           Json?
  deviceId                String?
  extensionCount          Int                       @default(0)
  isTrialExpired          Boolean                   @default(false)
  lastTrialCheck          DateTime                  @default(now())
  testsTakenCount         Int                       @default(0)
  trialExpiryDate         DateTime?
  trialExtended           Boolean                   @default(false)
  trialStartDate          DateTime                  @default(now())
  upgradedToUserId        String?
  achievements            achievements[]
  bookmarks               bookmarks[]
  forum_posts             forum_posts[]
  performance_reports     performance_reports[]
  study_plans             study_plans[]
  test_attempts           test_attempts[]
  test_sessions           test_sessions[]
  user_progress           user_progress[]
  user_question_responses user_question_responses[]

  @@index([deviceId])
  @@index([trialExpiryDate, isTrialExpired])
  @@index([upgradedToUserId])
}

model installments {
  id                String            @id
  feePlanId         String
  installmentNumber Int
  amount            Decimal           @db.Decimal(10, 2)
  dueDate           DateTime
  status            PaymentStatusEnum @default(PENDING)
  paidAt            DateTime?
  paidAmount        Decimal?          @db.Decimal(10, 2)
  razorpayOrderId   String?
  razorpayPaymentId String?
  paymentLink       String?
  remindersSent     Json?             @default("{\"1_day\": false, \"7_days\": false, \"due_date\": false}")
  createdAt         DateTime          @default(now())
  updatedAt         DateTime
  fee_plans         fee_plans         @relation(fields: [feePlanId], references: [id], onDelete: Cascade)

  @@index([feePlanId, dueDate])
  @@index([status, dueDate])
}

model lead_magnets {
  id               String           @id
  title            String
  description      String
  fileType         String
  fileUrl          String?
  fileSize         Int?
  thumbnailUrl     String?
  requiresEmail    Boolean          @default(true)
  requiresWhatsApp Boolean          @default(false)
  requiresName     Boolean          @default(true)
  features         Json?
  previewPages     Int?
  downloadCount    Int              @default(0)
  conversionRate   Float?
  isActive         Boolean          @default(true)
  createdAt        DateTime         @default(now())
  updatedAt        DateTime
  biology_topics   biology_topics[]
  content_leads    content_leads[]
}

model leads {
  id                      String                    @id
  studentName             String
  email                   String?
  phone                   String
  courseInterest          String
  stage                   LeadStage                 @default(NEW_LEAD)
  priority                Priority                  @default(WARM)
  assignedToId            String
  createdAt               DateTime                  @default(now())
  updatedAt               DateTime
  lastContactedAt         DateTime?
  nextFollowUpAt          DateTime?
  convertedAt             DateTime?
  lostAt                  DateTime?
  lostReason              String?
  demoBookingId           String?                   @unique
  source                  LeadSource                @default(MANUAL_ENTRY)
  score                   Int?
  scoreBreakdown          Json?
  scoreUpdatedAt          DateTime?
  activities              activities[]
  agent_tasks             agent_tasks[]
  crm_communications      crm_communications[]
  fee_plans               fee_plans[]
  followup_history        followup_history[]
  followup_queue          followup_queue[]
  users                   users                     @relation(fields: [assignedToId], references: [id])
  demo_bookings           demo_bookings?            @relation(fields: [demoBookingId], references: [id])
  notes                   notes[]
  offers                  offers[]
  product_recommendations product_recommendations[]
  tasks                   tasks[]
  whatsapp_conversations  whatsapp_conversations[]

  @@index([assignedToId, stage])
  @@index([assignedToId, score])
  @@index([createdAt])
  @@index([email])
  @@index([nextFollowUpAt])
  @@index([phone])
  @@index([score])
}

model material_access {
  id              String          @id
  materialId      String
  userId          String
  grantedBy       String
  grantedAt       DateTime        @default(now())
  expiresAt       DateTime?
  reason          String?
  study_materials study_materials @relation(fields: [materialId], references: [id], onDelete: Cascade)
  users           users           @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([materialId, userId])
  @@index([userId])
}

model material_progress {
  id              String          @id
  materialId      String
  userId          String
  status          ProgressStatus  @default(NOT_STARTED)
  firstViewedAt   DateTime?
  lastViewedAt    DateTime?
  downloadedAt    DateTime?
  completedAt     DateTime?
  currentPage     Int?
  totalPages      Int?
  timeSpent       Int             @default(0)
  rating          Int?
  feedback        String?
  notes           String?
  createdAt       DateTime        @default(now())
  updatedAt       DateTime
  study_materials study_materials @relation(fields: [materialId], references: [id], onDelete: Cascade)
  users           users           @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([materialId, userId])
  @@index([materialId, updatedAt])
  @@index([userId, status])
}

model message_templates {
  id          String   @id
  name        String
  type        CommType
  subject     String?
  message     String
  isActive    Boolean  @default(true)
  usageCount  Int      @default(0)
  createdById String
  createdAt   DateTime @default(now())
  updatedAt   DateTime
  users       users    @relation(fields: [createdById], references: [id])

  @@index([type, isActive])
}

model notes {
  id          String   @id
  leadId      String
  content     String
  createdById String
  createdAt   DateTime @default(now())
  updatedAt   DateTime
  users       users    @relation(fields: [createdById], references: [id])
  leads       leads    @relation(fields: [leadId], references: [id], onDelete: Cascade)

  @@index([leadId, createdAt])
}

model offers {
  id              String       @id
  leadId          String
  offerCode       String       @unique
  offerName       String
  courseName      String
  originalPrice   Decimal      @db.Decimal(10, 2)
  discountType    DiscountType
  discountValue   Decimal      @db.Decimal(10, 2)
  finalPrice      Decimal      @db.Decimal(10, 2)
  validFrom       DateTime     @default(now())
  validUntil      DateTime
  isActive        Boolean      @default(true)
  status          OfferStatus  @default(SENT)
  sentAt          DateTime     @default(now())
  viewedAt        DateTime?
  acceptedAt      DateTime?
  termsConditions String?
  maxUses         Int          @default(1)
  usesCount       Int          @default(0)
  createdById     String
  offerCardUrl    String?
  createdAt       DateTime     @default(now())
  users           users        @relation(fields: [createdById], references: [id])
  leads           leads        @relation(fields: [leadId], references: [id], onDelete: Cascade)

  @@index([createdById])
  @@index([leadId, status])
  @@index([validUntil])
}

model otp_verifications {
  id        String   @id
  mobile    String
  otp       String
  purpose   String
  verified  Boolean  @default(false)
  expiresAt DateTime
  attempts  Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime

  @@index([expiresAt])
  @@index([mobile, createdAt])
  @@index([mobile])
}

model payments {
  id                String        @id
  userId            String
  enrollmentId      String?
  amount            Int
  currency          String        @default("INR")
  status            PaymentStatus @default(PENDING)
  paymentMethod     PaymentMethod
  razorpayOrderId   String?       @unique
  razorpayPaymentId String?       @unique
  razorpaySignature String?
  transactionId     String?
  failureReason     String?
  installmentNumber Int?
  totalInstallments Int?
  createdAt         DateTime      @default(now())
  updatedAt         DateTime
  completedAt       DateTime?
  enrollments       enrollments?  @relation(fields: [enrollmentId], references: [id])
  users             users         @relation(fields: [userId], references: [id])

  @@index([createdAt])
  @@index([enrollmentId, status])
  @@index([status, completedAt])
  @@index([userId, status])
}

model performance_reports {
  id              String      @id
  userId          String?
  freeUserId      String?
  reportType      ReportType  @default(WEEKLY)
  reportPeriod    String
  testsAttempted  Int         @default(0)
  averageScore    Float?
  totalStudyTime  Int         @default(0)
  improvementRate Float?
  biologyScore    Float?
  botanyScore     Float?
  zoologyScore    Float?
  strongTopics    Json?
  weakTopics      Json?
  improvingTopics Json?
  targetScore     Float?
  targetDate      DateTime?
  onTrackStatus   Boolean     @default(true)
  studyPlan       Json?
  focusAreas      Json?
  practiceTests   Json?
  periodStart     DateTime
  periodEnd       DateTime
  generatedAt     DateTime    @default(now())
  free_users      free_users? @relation(fields: [freeUserId], references: [id])
  users           users?      @relation(fields: [userId], references: [id])

  @@unique([freeUserId, reportType, reportPeriod])
  @@unique([userId, reportType, reportPeriod])
  @@index([reportType, periodStart])
}

model question_bank_questions {
  id             String          @id
  questionBankId String
  questionId     String
  testTemplateId String?
  orderIndex     Int
  groupLabel     String?
  question_banks question_banks  @relation(fields: [questionBankId], references: [id], onDelete: Cascade)
  questions      questions       @relation(fields: [questionId], references: [id], onDelete: Cascade)
  test_templates test_templates? @relation(fields: [testTemplateId], references: [id])

  @@unique([questionBankId, questionId])
  @@index([questionBankId, orderIndex])
}

model question_banks {
  id                      String                    @id
  name                    String
  description             String?
  category                QuestionBankCategory      @default(CUSTOM)
  curriculum              String
  grade                   String
  subject                 String                    @default("biology")
  topics                  Json?
  totalQuestions          Int                       @default(0)
  activeQuestions         Int                       @default(0)
  usageCount              Int                       @default(0)
  isActive                Boolean                   @default(true)
  isPublic                Boolean                   @default(false)
  createdAt               DateTime                  @default(now())
  updatedAt               DateTime
  createdBy               String?
  question_bank_questions question_bank_questions[]
}

model questions {
  id                        String                      @id
  topic                     String
  subtopic                  String?
  curriculum                String
  grade                     String
  type                      QuestionType
  question                  String
  options                   Json?
  correctAnswer             String
  explanation               String?
  source                    String?
  marks                     Int                         @default(1)
  timeLimit                 Int?
  tags                      Json?
  totalAttempts             Int                         @default(0)
  correctAttempts           Int                         @default(0)
  averageTime               Int?
  isActive                  Boolean                     @default(true)
  isVerified                Boolean                     @default(false)
  createdAt                 DateTime                    @default(now())
  updatedAt                 DateTime
  category                  QuestionCategory            @default(PRACTICE)
  conversionRate            Float?
  difficultyRating          Float?
  examYear                  Int?
  explanationImage          String?
  keywords                  Json?
  lastUsed                  DateTime?
  popularityScore           Float                       @default(0)
  qualityScore              Float?
  questionImage             String?
  relatedConcepts           Json?
  reportCount               Int                         @default(0)
  slug                      String?                     @unique
  solutionSteps             Json?
  subject                   String                      @default("biology")
  variantId                 String?
  verifiedBy                String?
  videoExplanation          String?
  difficulty                DifficultyLevel             @default(MEDIUM)
  question_bank_questions   question_bank_questions[]
  test_assignment_questions test_assignment_questions[]
  test_questions            test_questions[]
  user_question_responses   user_question_responses[]

  @@index([curriculum, grade])
  @@index([isActive, isVerified])
  @@index([popularityScore])
  @@index([subject, type])
  @@index([topic, difficulty])
}

model referral_codes {
  id                   String                 @id
  code                 String                 @unique
  userId               String?
  userEmail            String
  uses                 Int                    @default(0)
  maxUses              Int                    @default(10)
  discount             Int
  expiresAt            DateTime?
  createdAt            DateTime               @default(now())
  referral_redemptions referral_redemptions[]

  @@index([code])
  @@index([userEmail])
}

model referral_redemptions {
  id              String         @id
  referralCodeId  String
  redeemedBy      String
  redeemedByEmail String
  discountGiven   Int
  bookingId       String?
  createdAt       DateTime       @default(now())
  referral_codes  referral_codes @relation(fields: [referralCodeId], references: [id], onDelete: Cascade)

  @@index([redeemedByEmail])
  @@index([referralCodeId])
}

model reschedule_tokens {
  id        String   @id
  bookingId String   @unique
  token     String   @unique
  expiresAt DateTime
  used      Boolean  @default(false)
  createdAt DateTime @default(now())

  @@index([bookingId])
  @@index([token])
}

model sessions {
  id           String   @id
  sessionToken String   @unique
  userId       String
  expires      DateTime
  users        users    @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model study_materials {
  id                String              @id
  title             String
  description       String?
  materialType      MaterialType
  fileUrl           String
  fileName          String
  fileSize          Int
  mimeType          String              @default("application/pdf")
  courseId          String?
  chapterId         String?
  topicId           String?
  tags              Json?
  accessLevel       AccessLevel         @default(ENROLLED)
  requiredCourseId  String?
  sortOrder         Int                 @default(0)
  category          String?
  uploadedBy        String
  isPublished       Boolean             @default(false)
  publishedAt       DateTime?
  totalDownloads    Int                 @default(0)
  totalViews        Int                 @default(0)
  avgRating         Float               @default(0)
  ratingCount       Int                 @default(0)
  createdAt         DateTime            @default(now())
  updatedAt         DateTime
  material_access   material_access[]
  material_progress material_progress[]
  chapters          chapters?           @relation(fields: [chapterId], references: [id])
  courses           courses?            @relation(fields: [courseId], references: [id])
  topics            topics?             @relation(fields: [topicId], references: [id])
  video_lecture     video_lectures?

  @@index([courseId, isPublished])
  @@index([createdAt])
  @@index([materialType, accessLevel])
}

model study_plans {
  id              String     @id
  freeUserId      String
  title           String
  targetExam      String
  examDate        DateTime?
  schedule        Json
  currentWeek     Int        @default(1)
  totalWeeks      Int
  completedTopics Json?
  currentTopic    String?
  overallProgress Int        @default(0)
  isActive        Boolean    @default(true)
  createdAt       DateTime   @default(now())
  updatedAt       DateTime
  free_users      free_users @relation(fields: [freeUserId], references: [id], onDelete: Cascade)
}

model tasks {
  id                              String       @id
  leadId                          String?
  title                           String
  description                     String?
  type                            TaskType
  priority                        TaskPriority @default(MEDIUM)
  dueDate                         DateTime
  dueTime                         String?
  status                          TaskStatus   @default(PENDING)
  completedAt                     DateTime?
  assignedToId                    String
  createdById                     String?
  isAutoGenerated                 Boolean      @default(false)
  triggerEvent                    String?
  snoozedUntil                    DateTime?
  createdAt                       DateTime     @default(now())
  updatedAt                       DateTime
  users_tasks_assignedToIdTousers users        @relation("tasks_assignedToIdTousers", fields: [assignedToId], references: [id])
  users_tasks_createdByIdTousers  users?       @relation("tasks_createdByIdTousers", fields: [createdById], references: [id])
  leads                           leads?       @relation(fields: [leadId], references: [id], onDelete: Cascade)

  @@index([assignedToId, status, dueDate])
  @@index([dueDate, status])
  @@index([leadId])
}

model test_analytics {
  id                   String        @id
  testSessionId        String        @unique
  totalTime            Int
  averageTimePerQ      Float
  questionsAttempted   Int
  questionsCorrect     Int
  accuracy             Float
  questionsSkipped     Int           @default(0)
  questionsRevisited   Int           @default(0)
  timeDistribution     Json
  answerPattern        Json
  easyQuestions        Json
  mediumQuestions      Json
  hardQuestions        Json
  topicPerformance     Json
  strengthTopics       Json
  weaknessTopics       Json
  percentileRank       Float?
  averageComparison    Float?
  predictedScore       Float?
  recommendedStudyTime Int?
  analyzedAt           DateTime      @default(now())
  test_sessions        test_sessions @relation(fields: [testSessionId], references: [id], onDelete: Cascade)
}

model test_attempts {
  id               String           @id
  freeUserId       String
  title            String
  topics           Json?
  questionCount    Int
  timeLimit        Int?
  score            Int
  totalMarks       Int
  percentage       Float
  timeSpent        Int
  topicWiseScore   Json
  strengthAreas    Json?
  weaknessAreas    Json?
  recommendations  Json?
  status           TestStatus       @default(IN_PROGRESS)
  startedAt        DateTime         @default(now())
  submittedAt      DateTime?
  accuracy         Float?
  consistency      Float?
  improvementAreas Json?
  rank             Int?
  speed            Float?
  testTemplateId   String?
  difficulty       DifficultyLevel  @default(MEDIUM)
  free_users       free_users       @relation(fields: [freeUserId], references: [id], onDelete: Cascade)
  test_templates   test_templates?  @relation(fields: [testTemplateId], references: [id])
  test_questions   test_questions[]

  @@index([freeUserId, startedAt])
  @@index([percentage])
  @@index([testTemplateId])
}

model test_questions {
  id                String        @id
  testAttemptId     String
  questionId        String
  selectedAnswer    String?
  isCorrect         Boolean?
  timeSpent         Int?
  marksAwarded      Int           @default(0)
  attempts          Int           @default(1)
  confidenceLevel   Int?
  isMarkedForReview Boolean       @default(false)
  questions         questions     @relation(fields: [questionId], references: [id])
  test_attempts     test_attempts @relation(fields: [testAttemptId], references: [id], onDelete: Cascade)

  @@unique([testAttemptId, questionId])
}

model test_sessions {
  id                       String                    @id
  userId                   String?
  freeUserId               String?
  testTemplateId           String
  sessionToken             String                    @unique
  status                   TestSessionStatus         @default(NOT_STARTED)
  startedAt                DateTime?
  pausedAt                 DateTime?
  resumedAt                DateTime?
  submittedAt              DateTime?
  timeSpent                Int                       @default(0)
  remainingTime            Int?
  currentQuestionIndex     Int                       @default(0)
  questionsAnswered        Int                       @default(0)
  questionsMarkedForReview Int                       @default(0)
  browserInfo              Json?
  ipAddress                String?
  locationData             Json?
  tabSwitchCount           Int                       @default(0)
  fullscreenExits          Int                       @default(0)
  suspiciousActivity       Json?
  isProctored              Boolean                   @default(false)
  totalScore               Int?
  percentage               Float?
  rank                     Int?
  createdAt                DateTime                  @default(now())
  updatedAt                DateTime
  test_analytics           test_analytics?
  free_users               free_users?               @relation(fields: [freeUserId], references: [id])
  test_templates           test_templates            @relation(fields: [testTemplateId], references: [id])
  users                    users?                    @relation(fields: [userId], references: [id])
  user_question_responses  user_question_responses[]

  @@index([freeUserId, status])
  @@index([sessionToken])
  @@index([testTemplateId, submittedAt])
  @@index([userId, status])
}

model test_templates {
  id                      String                    @id
  title                   String
  description             String?
  slug                    String                    @unique
  type                    TestType                  @default(PRACTICE_TEST)
  category                TestCategory              @default(TOPIC_WISE)
  difficulty              DifficultyLevel           @default(MEDIUM)
  timeLimit               Int
  totalQuestions          Int
  totalMarks              Int
  passingMarks            Int?
  curriculum              String
  grade                   String
  subject                 String                    @default("biology")
  topics                  Json
  negativeMarking         Boolean                   @default(false)
  markingScheme           Json?
  questionDistribution    Json?
  instructions            Json?
  isAdaptive              Boolean                   @default(false)
  adaptiveSettings        Json?
  attemptCount            Int                       @default(0)
  averageScore            Float?
  averageTime             Int?
  popularityScore         Float                     @default(0)
  isActive                Boolean                   @default(true)
  isPremium               Boolean                   @default(false)
  isPublished             Boolean                   @default(false)
  publishedAt             DateTime?
  seoTitle                String?
  seoDescription          String?
  seoKeywords             Json?
  createdAt               DateTime                  @default(now())
  updatedAt               DateTime
  createdBy               String?
  question_bank_questions question_bank_questions[]
  test_assignments        test_assignments[]        @relation("AssignmentTemplate")
  test_attempts           test_attempts[]
  test_sessions           test_sessions[]

  @@index([curriculum, grade])
  @@index([isActive, isPublished])
  @@index([popularityScore])
  @@index([type, category])
}

model topics {
  id              String            @id
  chapterId       String
  title           String
  description     String?
  orderIndex      Int
  isActive        Boolean           @default(true)
  createdAt       DateTime          @default(now())
  updatedAt       DateTime
  assignments     assignments[]
  doubt_tickets   doubt_tickets[]
  study_materials study_materials[]
  chapters        chapters          @relation(fields: [chapterId], references: [id], onDelete: Cascade)
  video_chapters  video_chapters[]

  @@index([chapterId, orderIndex])
}

model user_progress {
  id              String          @id
  userId          String?
  freeUserId      String?
  topic           String
  subtopic        String?
  curriculum      String
  grade           String
  totalQuestions  Int             @default(0)
  correctAnswers  Int             @default(0)
  accuracy        Float           @default(0)
  averageTime     Int?
  improvementRate Float           @default(0)
  currentLevel    DifficultyLevel @default(EASY)
  masteryScore    Float           @default(0)
  recommendedNext Json?
  weakAreas       Json?
  strongAreas     Json?
  lastPracticed   DateTime?
  createdAt       DateTime        @default(now())
  updatedAt       DateTime
  free_users      free_users?     @relation(fields: [freeUserId], references: [id])
  users           users?          @relation(fields: [userId], references: [id])

  @@unique([freeUserId, topic, curriculum, grade])
  @@unique([userId, topic, curriculum, grade])
  @@index([topic, masteryScore])
}

model user_question_responses {
  id             String         @id
  userId         String?
  freeUserId     String?
  questionId     String
  testSessionId  String?
  selectedAnswer String?
  isCorrect      Boolean?
  timeSpent      Int?
  marksAwarded   Int            @default(0)
  confidence     Int?
  responseMode   ResponseMode   @default(TEST_MODE)
  deviceType     String?
  answeredAt     DateTime       @default(now())
  free_users     free_users?    @relation(fields: [freeUserId], references: [id])
  questions      questions      @relation(fields: [questionId], references: [id])
  test_sessions  test_sessions? @relation(fields: [testSessionId], references: [id])
  users          users?         @relation(fields: [userId], references: [id])

  @@index([freeUserId, answeredAt])
  @@index([questionId, isCorrect])
  @@index([userId, answeredAt])
}

model parent_child_relationships {
  id        String   @id @default(cuid())
  parentId  String
  childId   String
  createdAt DateTime @default(now())
  child     users    @relation("ChildRelationship", fields: [childId], references: [id], onDelete: Cascade)
  parent    users    @relation("ParentRelationship", fields: [parentId], references: [id], onDelete: Cascade)

  @@unique([parentId, childId])
  @@index([parentId])
  @@index([childId])
}

model users {
  id                              String                        @id
  email                           String                        @unique
  phone                           String?                       @unique
  name                            String
  role                            UserRole                      @default(STUDENT)
  passwordHash                    String?
  emailVerified                   DateTime?
  phoneVerified                   DateTime?
  profile                         Json?
  createdAt                       DateTime                      @default(now())
  updatedAt                       DateTime
  lastActiveAt                    DateTime?
  verificationToken               String?
  verificationTokenExpiry         DateTime?
  activities                      activities[]
  student_submissions             assignment_submissions[]      @relation("StudentSubmissions")
  teacher_assignments             assignments[]                 @relation("TeacherAssignments")
  certificates                    certificates[]                @relation("StudentCertificates")
  teacher_sessions                class_sessions[]              @relation("TeacherSessions")
  communication_logs              communication_logs[]
  counselor_goals                 counselor_goals[]             @relation("CounselorGoals")
  counselor_kpis                  counselor_kpis[]              @relation("CounselorKPIs")
  counselor_leaderboard           counselor_leaderboard[]       @relation("CounselorLeaderboard")
  crm_communications              crm_communications[]
  demo_bookings                   demo_bookings[]
  doubt_messages_sent             doubt_messages[]              @relation("DoubtMessageSender")
  instructor_doubts               doubt_tickets[]               @relation("InstructorDoubts")
  student_doubts                  doubt_tickets[]               @relation("StudentDoubts")
  enrollments                     enrollments[]
  error_reports                   error_reports[]
  fee_plans                       fee_plans[]
  followup_history_created        followup_history[]            @relation("FollowupHistoryCreator")
  followup_rules_created          followup_rules[]              @relation("FollowupRuleCreator")
  followup_rules_updated          followup_rules[]              @relation("FollowupRuleUpdater")
  followup_templates_created      followup_templates[]          @relation("FollowupTemplateCreator")
  leads                           leads[]
  lms_device_sessions             lms_device_sessions[]
  lms_progress_notifications      lms_progress_notifications[]
  lms_security_events             lms_security_events[]
  lms_whatsapp_session            lms_whatsapp_sessions?
  material_access                 material_access[]
  material_progress               material_progress[]
  message_templates               message_templates[]
  notes                           notes[]
  offers                          offers[]
  child_relationships             parent_child_relationships[]  @relation("ChildRelationship")
  parent_relationships            parent_child_relationships[]  @relation("ParentRelationship")
  payments                        payments[]
  performance_reports             performance_reports[]
  product_recommendations         product_recommendations[]
  security_audit_logs             security_audit_logs[]
  sessions                        sessions[]
  marked_attendance               student_attendance[]          @relation("AttendanceMarker")
  student_attendance              student_attendance[]          @relation("StudentAttendance")
  tasks_tasks_assignedToIdTousers tasks[]                       @relation("tasks_assignedToIdTousers")
  tasks_tasks_createdByIdTousers  tasks[]                       @relation("tasks_createdByIdTousers")
  student_test_submissions        test_assignment_submissions[] @relation("StudentTestSubmissions")
  teacher_test_assignments        test_assignments[]            @relation("TeacherTestAssignments")
  test_sessions                   test_sessions[]
  user_device_limits              user_device_limits?
  user_progress                   user_progress[]
  user_question_responses         user_question_responses[]
  video_notes                     video_notes[]
  video_progress                  video_progress[]
  whatsapp_conversations          whatsapp_conversations[]      @relation("AssignedCounselor")
  whatsapp_messages_sent          whatsapp_messages[]           @relation("SentByUser")

  @@index([role, createdAt])
  @@index([lastActiveAt])
  @@index([emailVerified])
}

model whatsapp_otp {
  id        String   @id @default(cuid())
  phone     String
  otp       String
  expiresAt DateTime
  verified  Boolean  @default(false)
  attempts  Int      @default(0)
  createdAt DateTime @default(now())

  @@index([phone, expiresAt])
  @@index([phone, verified])
}

model whatsapp_conversations {
  id                  String              @id @default(cuid())
  phone               String
  leadId              String?
  assignedCounselorId String?
  lastMessageAt       DateTime            @default(now())
  status              ConversationStatus  @default(ACTIVE)
  createdAt           DateTime            @default(now())
  updatedAt           DateTime            @updatedAt
  users               users?              @relation("AssignedCounselor", fields: [assignedCounselorId], references: [id])
  leads               leads?              @relation(fields: [leadId], references: [id])
  messages            whatsapp_messages[]

  @@index([phone])
  @@index([leadId])
  @@index([assignedCounselorId])
  @@index([status, lastMessageAt])
}

model whatsapp_messages {
  id             String                 @id @default(cuid())
  conversationId String
  messageId      String?                @unique
  phone          String
  direction      MessageDirection
  content        String
  messageType    String                 @default("text")
  mediaUrl       String?
  status         MessageStatus          @default(SENT)
  sentBy         String?
  timestamp      DateTime               @default(now())
  createdAt      DateTime               @default(now())
  conversation   whatsapp_conversations @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  users          users?                 @relation("SentByUser", fields: [sentBy], references: [id])

  @@index([conversationId, timestamp])
  @@index([phone])
  @@index([messageId])
}

model security_audit_logs {
  id        String                 @id @default(cuid())
  eventType SecurityAuditEventType
  userId    String?
  userEmail String?
  userRole  String?
  ipAddress String
  userAgent String
  severity  SecurityAuditSeverity
  pathname  String?
  query     Json?
  referrer  String?
  details   Json
  timestamp DateTime               @default(now())
  users     users?                 @relation(fields: [userId], references: [id])

  @@index([eventType, timestamp])
  @@index([severity, timestamp])
  @@index([userId, timestamp])
  @@index([ipAddress, timestamp])
  @@index([timestamp])
}

model error_reports {
  id          String              @id @default(cuid())
  fingerprint String
  message     String
  stack       String?
  errorName   String              @default("Error")
  severity    ErrorReportSeverity @default(normal)
  context     Json?
  url         String?
  userAgent   String?
  clientIP    String
  userId      String?
  resolved    Boolean             @default(false)
  resolvedAt  DateTime?
  resolvedBy  String?
  occurrences Int                 @default(1)
  firstSeen   DateTime            @default(now())
  lastSeen    DateTime            @default(now())
  createdAt   DateTime            @default(now())
  updatedAt   DateTime            @updatedAt
  users       users?              @relation(fields: [userId], references: [id])

  @@index([fingerprint, lastSeen])
  @@index([severity, resolved, lastSeen])
  @@index([clientIP, lastSeen])
  @@index([userId, lastSeen])
  @@index([createdAt])
}

model error_feedback {
  id                String   @id @default(cuid())
  errorId           String
  description       String
  email             String?
  reproductionSteps String?
  clientIP          String
  createdAt         DateTime @default(now())

  @@index([errorId, createdAt])
  @@index([createdAt])
}

model doubt_categories {
  id            String          @id @default(cuid())
  name          String          @unique
  description   String?
  icon          String?
  color         String?
  sortOrder     Int             @default(0)
  isActive      Boolean         @default(true)
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt
  doubt_tickets doubt_tickets[]

  @@index([isActive, sortOrder])
}

model doubt_tickets {
  id              String            @id @default(cuid())
  studentId       String
  instructorId    String?
  categoryId      String?
  subject         String
  description     String
  priority        DoubtPriority     @default(MEDIUM)
  status          DoubtStatus       @default(OPEN)
  attachments     String[]
  tags            String[]
  courseId        String?
  chapterId       String?
  topicId         String?
  viewCount       Int               @default(0)
  responseTime    Int?
  resolvedAt      DateTime?
  lastMessageAt   DateTime          @default(now())
  studentRating   Int?
  studentFeedback String?
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  messages        doubt_messages[]
  category        doubt_categories? @relation(fields: [categoryId], references: [id])
  chapter         chapters?         @relation(fields: [chapterId], references: [id])
  course          courses?          @relation(fields: [courseId], references: [id])
  instructor      users?            @relation("InstructorDoubts", fields: [instructorId], references: [id])
  student         users             @relation("StudentDoubts", fields: [studentId], references: [id], onDelete: Cascade)
  topic           topics?           @relation(fields: [topicId], references: [id])

  @@index([studentId, status, createdAt])
  @@index([instructorId, status])
  @@index([categoryId, status])
  @@index([status, priority, createdAt])
  @@index([courseId])
  @@index([lastMessageAt])
}

model doubt_messages {
  id          String        @id @default(cuid())
  doubtId     String
  senderId    String
  message     String
  messageType MessageType   @default(TEXT)
  attachments String[]
  isRead      Boolean       @default(false)
  readAt      DateTime?
  metadata    Json?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  doubt       doubt_tickets @relation(fields: [doubtId], references: [id], onDelete: Cascade)
  sender      users         @relation("DoubtMessageSender", fields: [senderId], references: [id], onDelete: Cascade)

  @@index([doubtId, createdAt])
  @@index([senderId])
  @@index([isRead])
}

model assignments {
  id                    String                   @id @default(cuid())
  teacherId             String
  courseId              String?
  chapterId             String?
  topicId               String?
  title                 String
  description           String
  instructions          String?
  maxMarks              Int
  dueDate               DateTime
  allowLateSubmission   Boolean                  @default(false)
  allowResubmission     Boolean                  @default(false)
  latePenaltyPercentage Int                      @default(0)
  status                AssignmentStatus         @default(DRAFT)
  attachments           String[]
  createdAt             DateTime                 @default(now())
  updatedAt             DateTime                 @updatedAt
  publishedAt           DateTime?
  submissions           assignment_submissions[]
  chapter               chapters?                @relation(fields: [chapterId], references: [id])
  course                courses?                 @relation(fields: [courseId], references: [id])
  teacher               users                    @relation("TeacherAssignments", fields: [teacherId], references: [id], onDelete: Cascade)
  topic                 topics?                  @relation(fields: [topicId], references: [id])

  @@index([teacherId, status])
  @@index([courseId, status])
  @@index([dueDate, status])
  @@index([status, publishedAt])
}

model assignment_submissions {
  id                String           @id @default(cuid())
  assignmentId      String
  studentId         String
  submittedFiles    String[]
  submittedText     String?
  status            SubmissionStatus @default(NOT_SUBMITTED)
  submittedAt       DateTime?
  grade             Int?
  feedback          String?
  gradedAt          DateTime?
  isLate            Boolean          @default(false)
  resubmissionCount Int              @default(0)
  lastResubmittedAt DateTime?
  createdAt         DateTime         @default(now())
  updatedAt         DateTime         @updatedAt
  assignment        assignments      @relation(fields: [assignmentId], references: [id], onDelete: Cascade)
  student           users            @relation("StudentSubmissions", fields: [studentId], references: [id], onDelete: Cascade)

  @@unique([assignmentId, studentId])
  @@index([studentId, status])
  @@index([assignmentId, status])
  @@index([submittedAt])
  @@index([status, gradedAt])
}

model certificate_templates {
  id              String          @id @default(cuid())
  name            String
  description     String?
  templateType    CertificateType @default(COURSE_COMPLETION)
  designType      DesignType      @default(MODERN)
  primaryColor    String          @default("#2563eb")
  secondaryColor  String          @default("#1e40af")
  accentColor     String          @default("#dbeafe")
  fontFamily      String          @default("Inter")
  layout          Json
  backgroundImage String?
  logoUrl         String?
  signatureFields Json
  customFields    Json?
  isActive        Boolean         @default(true)
  isDefault       Boolean         @default(false)
  usageCount      Int             @default(0)
  createdBy       String?
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  certificates    certificates[]

  @@index([templateType, isActive])
  @@index([isDefault])
}

model certificates {
  id                String                 @id @default(cuid())
  studentId         String
  courseId          String?
  enrollmentId      String?
  templateId        String?
  certificateType   CertificateType        @default(COURSE_COMPLETION)
  certificateNumber String                 @unique
  verificationCode  String                 @unique
  studentName       String
  courseName        String
  completionDate    DateTime
  issueDate         DateTime               @default(now())
  validUntil        DateTime?
  grade             String?
  percentage        Float?
  duration          String?
  instructorNames   Json?
  achievements      Json?
  qrCodeUrl         String?
  certificatePdfUrl String?
  thumbnailUrl      String?
  status            CertificateStatus      @default(ISSUED)
  revokedAt         DateTime?
  revokedBy         String?
  revokeReason      String?
  downloadCount     Int                    @default(0)
  lastDownloadedAt  DateTime?
  viewCount         Int                    @default(0)
  shareCount        Int                    @default(0)
  metadata          Json?
  createdAt         DateTime               @default(now())
  updatedAt         DateTime               @updatedAt
  course            courses?               @relation(fields: [courseId], references: [id])
  enrollment        enrollments?           @relation(fields: [enrollmentId], references: [id])
  student           users                  @relation("StudentCertificates", fields: [studentId], references: [id], onDelete: Cascade)
  template          certificate_templates? @relation(fields: [templateId], references: [id])

  @@index([studentId, status, issueDate])
  @@index([courseId, status])
  @@index([verificationCode])
  @@index([certificateNumber])
  @@index([certificateType, status])
  @@index([status, issueDate])
}

model class_sessions {
  id               String               @id @default(cuid())
  courseId         String
  enrollmentId     String?
  title            String
  description      String?
  sessionType      SessionType          @default(REGULAR)
  scheduledDate    DateTime
  startTime        DateTime
  endTime          DateTime
  duration         Int
  teacherId        String
  meetingLink      String?
  meetingId        String?
  meetingPassword  String?
  location         String?
  topic            String?
  chapter          String?
  syllabusCovered  Json?
  status           SessionStatus        @default(SCHEDULED)
  cancelledAt      DateTime?
  cancelReason     String?
  rescheduledFrom  String?
  attendanceMarked Boolean              @default(false)
  totalStudents    Int                  @default(0)
  presentCount     Int                  @default(0)
  absentCount      Int                  @default(0)
  lateCount        Int                  @default(0)
  recordingUrl     String?
  notesUrl         String?
  materialsUrl     Json?
  homeworkAssigned String?
  metadata         Json?
  createdAt        DateTime             @default(now())
  updatedAt        DateTime             @updatedAt
  course           courses              @relation(fields: [courseId], references: [id], onDelete: Cascade)
  enrollment       enrollments?         @relation(fields: [enrollmentId], references: [id])
  teacher          users                @relation("TeacherSessions", fields: [teacherId], references: [id], onDelete: Cascade)
  attendance       student_attendance[]

  @@index([courseId, scheduledDate])
  @@index([teacherId, scheduledDate])
  @@index([enrollmentId, scheduledDate])
  @@index([status, scheduledDate])
  @@index([scheduledDate])
}

model student_attendance {
  id                 String           @id @default(cuid())
  sessionId          String
  studentId          String
  enrollmentId       String?
  status             AttendanceStatus @default(ABSENT)
  markedAt           DateTime         @default(now())
  markedBy           String
  checkInTime        DateTime?
  checkOutTime       DateTime?
  duration           Int?
  isLate             Boolean          @default(false)
  lateBy             Int?
  notes              String?
  isExcused          Boolean          @default(false)
  participationScore Int?
  deviceInfo         String?
  ipAddress          String?
  location           String?
  metadata           Json?
  createdAt          DateTime         @default(now())
  updatedAt          DateTime         @updatedAt
  enrollment         enrollments?     @relation(fields: [enrollmentId], references: [id])
  markedByUser       users            @relation("AttendanceMarker", fields: [markedBy], references: [id])
  session            class_sessions   @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  student            users            @relation("StudentAttendance", fields: [studentId], references: [id], onDelete: Cascade)

  @@unique([sessionId, studentId])
  @@index([sessionId, status])
  @@index([studentId, status])
  @@index([enrollmentId, status])
  @@index([markedAt])
  @@index([status, markedAt])
}

model attendance_settings {
  id                      String       @id @default(cuid())
  courseId                String?      @unique
  enrollmentId            String?      @unique
  autoMarkAbsent          Boolean      @default(true)
  autoMarkAfterMinutes    Int          @default(15)
  lateThresholdMinutes    Int          @default(10)
  minAttendancePercentage Float        @default(75.0)
  allowSelfCheckIn        Boolean      @default(false)
  requireLocation         Boolean      @default(false)
  allowedLocations        Json?
  sendAbsentNotifications Boolean      @default(true)
  sendLateNotifications   Boolean      @default(true)
  parentNotifications     Boolean      @default(true)
  metadata                Json?
  createdAt               DateTime     @default(now())
  updatedAt               DateTime     @updatedAt
  course                  courses?     @relation(fields: [courseId], references: [id], onDelete: Cascade)
  enrollment              enrollments? @relation(fields: [enrollmentId], references: [id], onDelete: Cascade)

  @@index([courseId])
  @@index([enrollmentId])
}

model counselor_kpis {
  id                     String   @id @default(cuid())
  counselorId            String
  date                   DateTime @db.Date
  leadsCreated           Int      @default(0)
  leadsContacted         Int      @default(0)
  leadsConverted         Int      @default(0)
  demosScheduled         Int      @default(0)
  demosCompleted         Int      @default(0)
  demosNoShow            Int      @default(0)
  callsMade              Int      @default(0)
  callDurationTotal      Int      @default(0)
  whatsappsSent          Int      @default(0)
  emailsSent             Int      @default(0)
  avgResponseTime        Int?
  conversionRate         Decimal? @db.Decimal(5, 2)
  followUpsMade          Int      @default(0)
  tasksCompleted         Int      @default(0)
  tasksPending           Int      @default(0)
  revenueGenerated       Decimal  @default(0) @db.Decimal(12, 2)
  enrollmentsGenerated   Int      @default(0)
  avgDealValue           Decimal? @db.Decimal(10, 2)
  newLeads               Int      @default(0)
  qualifiedLeads         Int      @default(0)
  demoScheduledLeads     Int      @default(0)
  demoCompletedLeads     Int      @default(0)
  offerSentLeads         Int      @default(0)
  negotiatingLeads       Int      @default(0)
  enrolledLeads          Int      @default(0)
  lostLeads              Int      @default(0)
  dailyLeadTarget        Int      @default(10)
  weeklyConversionTarget Int      @default(5)
  monthlyRevenueTarget   Decimal  @default(100000) @db.Decimal(12, 2)
  notes                  String?
  metadata               Json?
  createdAt              DateTime @default(now())
  updatedAt              DateTime @updatedAt
  counselor              users    @relation("CounselorKPIs", fields: [counselorId], references: [id], onDelete: Cascade)

  @@unique([counselorId, date])
  @@index([counselorId, date(sort: Desc)])
  @@index([date])
  @@index([conversionRate])
  @@index([revenueGenerated])
}

model counselor_goals {
  id           String            @id @default(cuid())
  counselorId  String
  goalType     CounselorGoalType
  period       GoalPeriod
  targetValue  Decimal           @db.Decimal(12, 2)
  currentValue Decimal           @default(0) @db.Decimal(12, 2)
  startDate    DateTime
  endDate      DateTime
  status       GoalStatus        @default(ACTIVE)
  achievedAt   DateTime?
  progress     Decimal           @default(0) @db.Decimal(5, 2)
  metadata     Json?
  createdAt    DateTime          @default(now())
  updatedAt    DateTime          @updatedAt
  counselor    users             @relation("CounselorGoals", fields: [counselorId], references: [id], onDelete: Cascade)

  @@index([counselorId, period, status])
  @@index([status, endDate])
  @@index([goalType, period])
}

model counselor_leaderboard {
  id              String     @id @default(cuid())
  counselorId     String
  period          GoalPeriod
  periodStart     DateTime
  periodEnd       DateTime
  rank            Int
  totalLeads      Int        @default(0)
  conversions     Int        @default(0)
  revenue         Decimal    @default(0) @db.Decimal(12, 2)
  conversionRate  Decimal    @default(0) @db.Decimal(5, 2)
  avgResponseTime Int?
  score           Decimal    @default(0) @db.Decimal(8, 2)
  createdAt       DateTime   @default(now())
  updatedAt       DateTime   @updatedAt
  counselor       users      @relation("CounselorLeaderboard", fields: [counselorId], references: [id], onDelete: Cascade)

  @@unique([counselorId, period, periodStart])
  @@index([period, periodStart, rank])
  @@index([score])
}

model followup_rules {
  id                String              @id @default(cuid())
  name              String
  description       String?
  isActive          Boolean             @default(true)
  triggerType       FollowupTrigger
  triggerConditions Json
  delayMinutes      Int
  actionType        FollowupAction
  templateId        String?
  priority          Priority            @default(WARM)
  assignToCounselor Boolean             @default(true)
  createdById       String
  updatedById       String?
  createdAt         DateTime            @default(now())
  updatedAt         DateTime            @updatedAt
  followup_queue    followup_queue[]
  createdBy         users               @relation("FollowupRuleCreator", fields: [createdById], references: [id])
  template          followup_templates? @relation(fields: [templateId], references: [id])
  updatedBy         users?              @relation("FollowupRuleUpdater", fields: [updatedById], references: [id])

  @@index([isActive, triggerType])
  @@index([createdById])
}

model followup_templates {
  id          String           @id @default(cuid())
  name        String
  description String?
  channel     FollowupAction
  subject     String?
  content     String
  variables   Json
  isActive    Boolean          @default(true)
  createdById String
  createdAt   DateTime         @default(now())
  updatedAt   DateTime         @updatedAt
  rules       followup_rules[]
  createdBy   users            @relation("FollowupTemplateCreator", fields: [createdById], references: [id])

  @@index([channel, isActive])
  @@index([createdById])
}

model followup_queue {
  id            String         @id @default(cuid())
  leadId        String
  ruleId        String
  scheduledFor  DateTime
  status        QueueStatus    @default(PENDING)
  attempt       Int            @default(0)
  maxAttempts   Int            @default(3)
  lastAttemptAt DateTime?
  completedAt   DateTime?
  errorMessage  String?
  metadata      Json?
  createdAt     DateTime       @default(now())
  updatedAt     DateTime       @updatedAt
  lead          leads          @relation(fields: [leadId], references: [id], onDelete: Cascade)
  rule          followup_rules @relation(fields: [ruleId], references: [id])

  @@index([scheduledFor, status])
  @@index([leadId])
  @@index([status])
  @@index([ruleId])
}

model followup_history {
  id          String         @id @default(cuid())
  leadId      String
  ruleId      String?
  action      FollowupAction
  channel     String?
  content     String?
  sentAt      DateTime       @default(now())
  status      String
  metadata    Json?
  createdById String?
  isAutomated Boolean        @default(true)
  createdBy   users?         @relation("FollowupHistoryCreator", fields: [createdById], references: [id])
  lead        leads          @relation(fields: [leadId], references: [id], onDelete: Cascade)

  @@index([leadId, sentAt])
  @@index([status])
  @@index([isAutomated, sentAt])
}

model newsletterSubscriber {
  id        String   @id @default(cuid())
  email     String   @unique
  status    String   @default("active")
  source    String?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([status])
  @@index([createdAt])
}

model test_assignments {
  id                 String                        @id @default(cuid())
  teacherId          String
  testTemplateId     String?
  title              String
  description        String?
  instructions       String?
  difficulty         DifficultyLevel               @default(MEDIUM)
  totalQuestions     Int
  totalMarks         Int
  duration           Int
  negativeMarking    Boolean                       @default(false)
  negativeMarkValue  Decimal?                      @db.Decimal(3, 2)
  shuffleQuestions   Boolean                       @default(false)
  showResults        ShowResultsType               @default(IMMEDIATELY)
  passingMarks       Int?
  assignToType       AssignToType                  @default(ALL_STUDENTS)
  assignedClassIds   String[]
  assignedBatchIds   String[]
  assignedStudentIds String[]
  courseId           String?
  dueDate            DateTime
  availableFrom      DateTime?
  status             TestAssignmentStatus          @default(DRAFT)
  publishedAt        DateTime?
  selectedChapters   String[]
  selectedTopics     String[]
  questionSource     QuestionSourceType            @default(QUESTION_BANK)
  useAI              Boolean                       @default(false)
  totalAssigned      Int                           @default(0)
  totalSubmitted     Int                           @default(0)
  totalGraded        Int                           @default(0)
  averageScore       Decimal?                      @db.Decimal(5, 2)
  metadata           Json?
  createdAt          DateTime                      @default(now())
  updatedAt          DateTime                      @updatedAt
  questions          test_assignment_questions[]
  submissions        test_assignment_submissions[]
  teacher            users                         @relation("TeacherTestAssignments", fields: [teacherId], references: [id], onDelete: Cascade)
  testTemplate       test_templates?               @relation("AssignmentTemplate", fields: [testTemplateId], references: [id])

  @@index([teacherId, status])
  @@index([status, dueDate])
  @@index([courseId])
  @@index([dueDate])
}

model test_assignment_questions {
  id               String           @id @default(cuid())
  testAssignmentId String
  questionId       String
  orderIndex       Int
  marks            Int              @default(4)
  negativeMarks    Decimal?         @db.Decimal(3, 2)
  question         questions        @relation(fields: [questionId], references: [id], onDelete: Cascade)
  testAssignment   test_assignments @relation(fields: [testAssignmentId], references: [id], onDelete: Cascade)

  @@unique([testAssignmentId, questionId])
  @@index([testAssignmentId, orderIndex])
}

model test_assignment_submissions {
  id                 String               @id @default(cuid())
  testAssignmentId   String
  studentId          String
  status             SubmissionTestStatus @default(NOT_STARTED)
  startedAt          DateTime?
  submittedAt        DateTime?
  timeSpent          Int                  @default(0)
  remainingTime      Int?
  tabSwitchCount     Int                  @default(0)
  fullscreenExits    Int                  @default(0)
  browserInfo        Json?
  totalScore         Int?
  percentage         Decimal?             @db.Decimal(5, 2)
  questionsAttempted Int                  @default(0)
  questionsCorrect   Int                  @default(0)
  questionsWrong     Int                  @default(0)
  questionsSkipped   Int                  @default(0)
  isGraded           Boolean              @default(false)
  gradedAt           DateTime?
  gradedBy           String?
  teacherFeedback    String?
  answers            Json?
  metadata           Json?
  createdAt          DateTime             @default(now())
  updatedAt          DateTime             @updatedAt
  student            users                @relation("StudentTestSubmissions", fields: [studentId], references: [id], onDelete: Cascade)
  testAssignment     test_assignments     @relation(fields: [testAssignmentId], references: [id], onDelete: Cascade)

  @@unique([testAssignmentId, studentId])
  @@index([studentId, status])
  @@index([testAssignmentId, status])
  @@index([submittedAt])
}

model agent_tasks {
  id              String              @id @default(cuid())
  agentType       AgentType
  leadId          String?
  communicationId String?
  status          AgentTaskStatus     @default(PENDING)
  input           Json
  output          Json?
  error           String?
  scheduledAt     DateTime?
  startedAt       DateTime?
  completedAt     DateTime?
  attempt         Int                 @default(0)
  maxAttempts     Int                 @default(3)
  metadata        Json?
  createdAt       DateTime            @default(now())
  updatedAt       DateTime            @updatedAt
  communication   crm_communications? @relation(fields: [communicationId], references: [id], onDelete: Cascade)
  lead            leads?              @relation(fields: [leadId], references: [id], onDelete: Cascade)

  @@index([status, scheduledAt])
  @@index([agentType, status])
  @@index([leadId])
  @@index([communicationId])
}

model free_resources {
  id            String            @id @default(cuid())
  title         String
  description   String?
  type          FreeResourceType
  fileUrl       String?
  content       String?
  thumbnailUrl  String?
  classCategory FreeResourceClass
  priority      Int               @default(0)
  isPublished   Boolean           @default(false)
  isArchived    Boolean           @default(false)
  publishedAt   DateTime?
  expiresAt     DateTime?
  viewCount     Int               @default(0)
  createdAt     DateTime          @default(now())
  updatedAt     DateTime          @updatedAt

  @@index([type, isPublished, isArchived])
  @@index([classCategory, isPublished])
  @@index([isPublished, priority])
  @@index([expiresAt])
}

model video_lectures {
  id                  String                @id @default(cuid())
  studyMaterialId     String                @unique
  cloudflareVideoId   String                @unique
  cloudflareStreamUrl String?
  cloudflareThumbUrl  String?
  playbackPolicy      PlaybackPolicy        @default(SIGNED_URL)
  title               String
  description         String?
  duration            Int
  resolution          String?
  fileSize            BigInt?
  hasPdfSync          Boolean               @default(false)
  syncPdfUrl          String?
  syncPdfPageCount    Int?
  uploadStatus        VideoUploadStatus     @default(PROCESSING)
  processingProgress  Int                   @default(0)
  processedAt         DateTime?
  totalViews          Int                   @default(0)
  totalWatchTime      Int                   @default(0)
  avgCompletionRate   Decimal               @default(0) @db.Decimal(5, 2)
  avgRating           Decimal               @default(0) @db.Decimal(3, 2)
  ratingCount         Int                   @default(0)
  previewSeconds      Int                   @default(30)
  requiresEnrollment  Boolean               @default(true)
  metadata            Json?
  createdAt           DateTime              @default(now())
  updatedAt           DateTime              @updatedAt
  securityEvents      lms_security_events[]
  pdfSyncData         pdf_sync_data[]
  chapters            video_chapters[]
  studyMaterial       study_materials       @relation(fields: [studyMaterialId], references: [id], onDelete: Cascade)
  notes               video_notes[]
  progress            video_progress[]

  @@index([cloudflareVideoId])
  @@index([uploadStatus])
  @@index([totalViews])
  @@index([avgRating])
}

model video_chapters {
  id             String         @id @default(cuid())
  videoLectureId String
  title          String
  description    String?
  startTime      Int
  endTime        Int?
  orderIndex     Int
  thumbnailUrl   String?
  topicId        String?
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  topics         topics?        @relation(fields: [topicId], references: [id])
  videoLecture   video_lectures @relation(fields: [videoLectureId], references: [id], onDelete: Cascade)

  @@index([videoLectureId, orderIndex])
  @@index([topicId])
}

model video_progress {
  id                 String         @id @default(cuid())
  videoLectureId     String
  userId             String
  enrollmentId       String?
  watchedSeconds     Int            @default(0)
  lastPosition       Int            @default(0)
  completionPercent  Decimal        @default(0) @db.Decimal(5, 2)
  isCompleted        Boolean        @default(false)
  completedAt        DateTime?
  totalWatchSessions Int            @default(0)
  lastWatchedAt      DateTime?
  firstWatchedAt     DateTime?
  pauseCount         Int            @default(0)
  seekCount          Int            @default(0)
  replayCount        Int            @default(0)
  playbackSpeed      Decimal        @default(1.0) @db.Decimal(3, 2)
  preferredQuality   String?
  rating             Int?
  ratedAt            DateTime?
  lastDeviceId       String?
  lastDeviceType     String?
  metadata           Json?
  createdAt          DateTime       @default(now())
  updatedAt          DateTime       @updatedAt
  enrollment         enrollments?   @relation(fields: [enrollmentId], references: [id])
  user               users          @relation(fields: [userId], references: [id], onDelete: Cascade)
  videoLecture       video_lectures @relation(fields: [videoLectureId], references: [id], onDelete: Cascade)

  @@unique([videoLectureId, userId])
  @@index([userId, lastWatchedAt])
  @@index([completionPercent])
  @@index([isCompleted])
}

model video_notes {
  id             String         @id @default(cuid())
  videoLectureId String
  userId         String
  timestamp      Int
  content        String
  aiSummary      String?
  isHighlighted  Boolean        @default(false)
  color          String?
  tags           String[]
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  user           users          @relation(fields: [userId], references: [id], onDelete: Cascade)
  videoLecture   video_lectures @relation(fields: [videoLectureId], references: [id], onDelete: Cascade)

  @@index([videoLectureId, userId, timestamp])
  @@index([userId, createdAt])
}

model pdf_sync_data {
  id              String         @id @default(cuid())
  videoLectureId  String
  videoTimestamp  Int
  pdfPage         Int
  sectionTitle    String?
  description     String?
  isAutoGenerated Boolean        @default(false)
  confidence      Decimal?       @db.Decimal(3, 2)
  createdAt       DateTime       @default(now())
  videoLecture    video_lectures @relation(fields: [videoLectureId], references: [id], onDelete: Cascade)

  @@unique([videoLectureId, videoTimestamp])
  @@index([videoLectureId, pdfPage])
}

model lms_device_sessions {
  id              String                @id @default(cuid())
  userId          String
  deviceId        String
  deviceName      String?
  deviceType      DeviceType
  browser         String?
  os              String?
  ipAddress       String?
  country         String?
  city            String?
  isActive        Boolean               @default(true)
  lastActiveAt    DateTime              @default(now())
  firstSeenAt     DateTime              @default(now())
  isTrusted       Boolean               @default(false)
  trustVerifiedAt DateTime?
  sessionToken    String                @unique
  expiresAt       DateTime?
  isRevoked       Boolean               @default(false)
  revokedAt       DateTime?
  revokedReason   String?
  metadata        Json?
  createdAt       DateTime              @default(now())
  updatedAt       DateTime              @updatedAt
  user            users                 @relation(fields: [userId], references: [id], onDelete: Cascade)
  securityEvents  lms_security_events[]

  @@index([userId, isActive])
  @@index([deviceId])
  @@index([sessionToken])
  @@index([lastActiveAt])
}

model lms_security_events {
  id                String               @id @default(cuid())
  userId            String?
  videoLectureId    String?
  deviceSessionId   String?
  eventType         LmsSecurityEvent
  severity          SecuritySeverity     @default(LOW)
  description       String
  ipAddress         String?
  userAgent         String?
  deviceFingerprint String?
  evidence          Json?
  actionTaken       String?
  isResolved        Boolean              @default(false)
  resolvedAt        DateTime?
  resolvedBy        String?
  createdAt         DateTime             @default(now())
  deviceSession     lms_device_sessions? @relation(fields: [deviceSessionId], references: [id])
  user              users?               @relation(fields: [userId], references: [id])
  videoLecture      video_lectures?      @relation(fields: [videoLectureId], references: [id])

  @@index([userId, createdAt])
  @@index([eventType, severity])
  @@index([videoLectureId])
  @@index([createdAt])
}

model user_device_limits {
  id               String    @id @default(cuid())
  userId           String    @unique
  maxDevices       Int       @default(2)
  activeDevices    Int       @default(0)
  violationCount   Int       @default(0)
  lastViolationAt  DateTime?
  isRestricted     Boolean   @default(false)
  restrictedUntil  DateTime?
  restrictedReason String?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime  @updatedAt
  user             users     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([isRestricted])
}

model lms_whatsapp_sessions {
  id                   String            @id @default(cuid())
  userId               String            @unique
  phone                String
  currentState         LmsWhatsAppState  @default(MAIN_MENU)
  contextData          Json?
  previousState        LmsWhatsAppState?
  navigationPath       Json?
  lastCourseId         String?
  lastChapterId        String?
  lastVideoId          String?
  lastInteractionAt    DateTime          @default(now())
  totalInteractions    Int               @default(0)
  preferredLanguage    String            @default("en")
  notificationsEnabled Boolean           @default(true)
  createdAt            DateTime          @default(now())
  updatedAt            DateTime          @updatedAt
  user                 users             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([phone])
  @@index([currentState])
  @@index([lastInteractionAt])
}

model lms_progress_notifications {
  id               String              @id @default(cuid())
  userId           String
  notificationType LmsNotificationType
  title            String
  message          String
  courseId         String?
  videoLectureId   String?
  sentVia          String[]
  sentAt           DateTime?
  readAt           DateTime?
  clickedAt        DateTime?
  scheduledFor     DateTime?
  metadata         Json?
  createdAt        DateTime            @default(now())
  user             users               @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId, createdAt])
  @@index([notificationType, sentAt])
  @@index([scheduledFor])
}

enum AccessLevel {
  FREE
  ENROLLED
  PREMIUM
  SPECIFIC_COURSE
}

enum AchievementType {
  FIRST_TEST
  STREAK_7_DAYS
  STREAK_30_DAYS
  TOPIC_MASTER
  SPEED_DEMON
  PERFECTIONIST
  COMMUNITY_HELPER
  BOOKWORM
}

enum CommStatus {
  PENDING
  SENT
  DELIVERED
  READ
  FAILED
}

enum CommType {
  WHATSAPP
  EMAIL
  CALL
  SMS
}

enum CommunicationChannel {
  WHATSAPP
  EMAIL
  SMS
  PHONE_CALL
  IN_APP_NOTIFICATION
}

enum CommunicationType {
  WELCOME_MESSAGE
  DEMO_CONFIRMATION
  DEMO_REMINDER
  ENROLLMENT_CONFIRMATION
  PAYMENT_REMINDER
  COURSE_UPDATE
  MARKETING_MESSAGE
  SUPPORT_MESSAGE
  FEEDBACK_REQUEST
  CUSTOM_MESSAGE
}

enum CourseType {
  NEET_COMPLETE
  CLASS_11
  CLASS_12
  DROPPER
  FOUNDATION
  CRASH_COURSE
}

enum DemoBookingStatus {
  PENDING
  CONFIRMED
  COMPLETED
  CANCELLED
  NO_SHOW
  RESCHEDULED
}

enum DemoPaymentStatus {
  NOT_REQUIRED
  PENDING
  COMPLETED
  FAILED
  REFUNDED
}

enum DemoType {
  FREE
  PREMIUM
}

enum DifficultyLevel {
  EASY
  MEDIUM
  HARD
  EXPERT
}

enum Direction {
  INBOUND
  OUTBOUND
}

enum DiscountType {
  PERCENTAGE
  FIXED_AMOUNT
}

enum EnrollmentStatus {
  PENDING
  ACTIVE
  COMPLETED
  CANCELLED
  SUSPENDED
}

enum FeeStatus {
  PENDING
  PARTIAL
  COMPLETED
  CANCELLED
}

enum LeadSource {
  MANUAL_ENTRY
  WALK_IN
  PHONE_CALL
  REFERRAL
  WHATSAPP
  EMAIL
  SOCIAL_MEDIA
  WEBSITE
  ADVERTISEMENT
  EVENT
  OTHER
}

enum LeadStage {
  NEW_LEAD
  DEMO_SCHEDULED
  DEMO_COMPLETED
  OFFER_SENT
  NEGOTIATING
  PAYMENT_PLAN_CREATED
  ENROLLED
  ACTIVE_STUDENT
  LOST
}

enum MaterialType {
  PDF_NOTES
  PDF_ASSIGNMENT
  PDF_PRACTICE_PAPER
  PDF_REFERENCE
  PDF_EBOOK
  VIDEO
  LINK
}

enum MessageStatus {
  SENT
  DELIVERED
  READ
  FAILED
  PENDING
}

enum NotificationStatus {
  DRAFT
  SCHEDULED
  SENDING
  SENT
  FAILED
  CANCELLED
}

enum NotificationType {
  NEW_MATERIAL
  ASSIGNMENT_REMINDER
  COURSE_UPDATE
  ANNOUNCEMENT
  CUSTOM
}

enum OfferStatus {
  DRAFT
  SENT
  VIEWED
  ACCEPTED
  EXPIRED
  CANCELLED
}

enum PaymentMethod {
  RAZORPAY_UPI
  RAZORPAY_CARD
  RAZORPAY_NETBANKING
  RAZORPAY_WALLET
  BANK_TRANSFER
  CASH
  CHEQUE
}

enum PaymentPlan {
  FULL
  QUARTERLY
  MONTHLY
  CUSTOM
}

enum PaymentStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  CANCELLED
  REFUNDED
}

enum PaymentStatusEnum {
  PENDING
  PAID
  OVERDUE
  FAILED
}

enum PostType {
  QUESTION
  DISCUSSION
  TIP
  RESOURCE
  ANNOUNCEMENT
}

enum Priority {
  HOT
  WARM
  COLD
}

enum ProgressStatus {
  NOT_STARTED
  VIEWED
  IN_PROGRESS
  DOWNLOADED
  COMPLETED
}

enum QuestionBankCategory {
  NEET_PREVIOUS_YEAR
  CBSE_BOARD
  NCERT_BASED
  COMPETITIVE
  CONCEPT_BUILDER
  CUSTOM
  PRACTICE_SET
}

enum QuestionCategory {
  PRACTICE
  MOCK_TEST
  PREVIOUS_YEAR
  CONCEPT_BUILDER
  COMPETITIVE
}

enum QuestionType {
  MCQ
  SHORT_ANSWER
  DIAGRAM
  TRUE_FALSE
  FILL_BLANK
  MULTIPLE_SELECT
  MATCH_FOLLOWING
  NUMERICAL
}

enum ReportType {
  DAILY
  WEEKLY
  MONTHLY
  QUARTERLY
  CUSTOM
}

enum ResponseMode {
  TEST_MODE
  PRACTICE_MODE
  REVIEW_MODE
  STUDY_MODE
}

enum StudentClass {
  CLASS_9
  CLASS_10
  CLASS_11
  CLASS_12
  DROPPER
  FOUNDATION
}

enum TaskPriority {
  HIGH
  MEDIUM
  LOW
}

enum TaskStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  SNOOZED
  CANCELLED
}

enum TaskType {
  FOLLOW_UP_CALL
  SEND_WHATSAPP
  SEND_EMAIL
  PAYMENT_REMINDER
  DEMO_FOLLOWUP
  CUSTOM
}

enum TestCategory {
  TOPIC_WISE
  SUBJECT_WISE
  FULL_SYLLABUS
  CHAPTER_WISE
  DIFFICULTY_WISE
  PREVIOUS_YEAR
  MIXED
}

enum TestSessionStatus {
  NOT_STARTED
  IN_PROGRESS
  PAUSED
  COMPLETED
  EXPIRED
  ABANDONED
  TERMINATED
}

enum TestStatus {
  IN_PROGRESS
  COMPLETED
  ABANDONED
  EXPIRED
}

enum TestType {
  PRACTICE_TEST
  MOCK_TEST
  FULL_TEST
  QUICK_TEST
  ADAPTIVE_TEST
  TIMED_TEST
  DIAGNOSTIC_TEST
}

enum UserRole {
  STUDENT
  PARENT
  TEACHER
  ADMIN
  COUNSELOR
}

enum ConversationStatus {
  ACTIVE
  ARCHIVED
  CLOSED
}

enum MessageDirection {
  INBOUND
  OUTBOUND
}

enum SecurityAuditEventType {
  login
  logout
  admin_access
  failed_login
  rate_limit_exceeded
  password_change
  account_locked
  suspicious_activity
  data_access
  data_modification
  permission_change
}

enum SecurityAuditSeverity {
  low
  medium
  high
  critical
}

enum ErrorReportSeverity {
  low
  normal
  high
  critical
}

enum DoubtStatus {
  OPEN
  IN_PROGRESS
  ANSWERED
  RESOLVED
  CLOSED
}

enum DoubtPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum MessageType {
  TEXT
  IMAGE
  FILE
  VOICE
  VIDEO
}

enum AssignmentStatus {
  DRAFT
  PUBLISHED
  CLOSED
}

enum SubmissionStatus {
  NOT_SUBMITTED
  SUBMITTED
  LATE
  GRADED
  RESUBMIT_REQUIRED
}

enum AttendanceStatus {
  PRESENT
  ABSENT
  LATE
  EXCUSED
  HALF_DAY
}

enum SessionType {
  REGULAR
  DOUBT_CLEARING
  REVISION
  TEST
  PRACTICAL
  WORKSHOP
  SEMINAR
  GUEST_LECTURE
  EXTRA_CLASS
}

enum SessionStatus {
  SCHEDULED
  ONGOING
  COMPLETED
  CANCELLED
  RESCHEDULED
}

enum CertificateType {
  COURSE_COMPLETION
  EXCELLENCE
  PARTICIPATION
  ACHIEVEMENT
  APPRECIATION
  SPECIAL_RECOGNITION
}

enum CertificateStatus {
  DRAFT
  ISSUED
  REVOKED
  EXPIRED
}

enum DesignType {
  MODERN
  CLASSIC
  PREMIUM
  MINIMALIST
  ELEGANT
}

enum CounselorGoalType {
  LEADS_CREATED
  CONVERSIONS
  REVENUE
  DEMOS_SCHEDULED
  FOLLOW_UPS
  RESPONSE_TIME
  CUSTOM
}

enum GoalPeriod {
  DAILY
  WEEKLY
  MONTHLY
  QUARTERLY
  YEARLY
}

enum GoalStatus {
  ACTIVE
  ACHIEVED
  MISSED
  CANCELLED
}

enum FollowupTrigger {
  STAGE_CHANGE
  TIME_BASED
  SCORE_THRESHOLD
  INACTIVITY
  DEMO_NO_SHOW
  DEMO_COMPLETED
  OFFER_SENT
  CUSTOM
}

enum FollowupAction {
  EMAIL
  WHATSAPP
  CALL_TASK
  SMS
  NOTIFICATION
  TASK
}

enum QueueStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  SKIPPED
  CANCELLED
}

enum TestAssignmentStatus {
  DRAFT
  PUBLISHED
  ACTIVE
  COMPLETED
  ARCHIVED
}

enum AssignToType {
  ALL_STUDENTS
  SPECIFIC_CLASS
  SPECIFIC_BATCH
  INDIVIDUAL_STUDENTS
}

enum ShowResultsType {
  IMMEDIATELY
  AFTER_DEADLINE
  MANUAL_RELEASE
  NEVER
}

enum QuestionSourceType {
  QUESTION_BANK
  AI_GENERATED
  MANUAL
  TEMPLATE
}

enum SubmissionTestStatus {
  NOT_STARTED
  IN_PROGRESS
  PAUSED
  SUBMITTED
  GRADED
}

enum AgentType {
  LEAD_QUALIFIER
  NURTURE
  CALL_PREP
  CONTENT_GENERATOR
  CALL_TRANSCRIPTION
  CALL_SUMMARY
  ACTION_EXTRACTOR
  PRODUCT_AGENT
}

enum AgentTaskStatus {
  PENDING
  SCHEDULED
  RUNNING
  COMPLETED
  FAILED
  CANCELLED
}

enum FreeResourceType {
  PDF
  TIMETABLE
  ANNOUNCEMENT
  NOTES
  FORMULA_SHEET
}

enum FreeResourceClass {
  CLASS_9
  CLASS_10
  CLASS_11
  CLASS_12
  DROPPERS
  ALL
}

enum PlaybackPolicy {
  PUBLIC
  SIGNED_URL
  TOKEN_AUTH
}

enum VideoUploadStatus {
  PENDING
  UPLOADING
  PROCESSING
  READY
  FAILED
  DELETED
}

enum DeviceType {
  DESKTOP
  MOBILE
  TABLET
  TV
  UNKNOWN
}

enum LmsSecurityEvent {
  DEVICE_LIMIT_EXCEEDED
  SCREEN_RECORDING_DETECTED
  SCREENSHOT_DETECTED
  SUSPICIOUS_ACTIVITY
  VPN_DETECTED
  CONCURRENT_STREAM
  DOWNLOAD_ATTEMPT
  WATERMARK_TAMPER
  GEO_RESTRICTION
  TOKEN_SHARING
  ACCOUNT_SHARING
}

enum SecuritySeverity {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum LmsWhatsAppState {
  MAIN_MENU
  MY_COURSES
  COURSE_DETAIL
  CHAPTER_LIST
  VIDEO_LIST
  VIDEO_DETAIL
  MY_PROGRESS
  CONTINUE_WATCHING
  SEARCH
  HELP
  SETTINGS
  NOTIFICATIONS
}

enum LmsNotificationType {
  NEW_VIDEO_ADDED
  COURSE_REMINDER
  PROGRESS_MILESTONE
  CHAPTER_COMPLETED
  COURSE_COMPLETED
  CERTIFICATE_READY
  LIVE_CLASS_REMINDER
  ASSIGNMENT_DUE
  NEW_ANNOUNCEMENT
}

// ============================================
// OMR EVALUATION SYSTEM
// ============================================

enum OMRPaperStatus {
  DRAFT
  ACTIVE
  CLOSED
  ARCHIVED
}

enum OMRSubjectType {
  BIOLOGY_XI
  BIOLOGY_XII
  BIOLOGY_XI_XII
  NEET_MOCK
}

enum OMRAnswerKeyStatus {
  UNVERIFIED
  VERIFIED
  DISPUTED
}

model omr_papers {
  id                    String          @id @default(cuid())
  paperCode             String          @unique
  title                 String
  description           String?

  subjectType           OMRSubjectType
  targetClass           String

  totalQuestions        Int
  totalMarks            Float
  marksPerCorrect       Float           @default(4)
  marksPerWrong         Float           @default(-1)
  marksPerUnattempted   Float           @default(0)

  sections              Json?

  examDate              DateTime
  submissionStart       DateTime
  submissionEnd         DateTime

  hasVerifiedKey        Boolean         @default(false)
  verifiedKeyUploadedAt DateTime?

  status                OMRPaperStatus  @default(DRAFT)
  isActive              Boolean         @default(true)

  createdBy             String?
  createdAt             DateTime        @default(now())
  updatedAt             DateTime        @updatedAt

  answerKeys            omr_answer_keys[]
  submissions           omr_submissions[]

  @@index([paperCode])
  @@index([subjectType, status])
  @@index([targetClass, status])
  @@index([examDate])
}

model omr_answer_keys {
  id               String              @id @default(cuid())
  paperId          String
  paper            omr_papers          @relation(fields: [paperId], references: [id], onDelete: Cascade)

  questionNo       Int
  section          String?

  correctAnswer    String
  explanation      String?             @db.Text
  topic            String?
  subtopic         String?
  difficulty       String?

  keyStatus        OMRAnswerKeyStatus  @default(UNVERIFIED)
  verifiedBy       String?
  verifiedAt       DateTime?
  verificationNote String?

  previousAnswer   String?
  changedAt        DateTime?
  changedReason    String?

  createdAt        DateTime            @default(now())
  updatedAt        DateTime            @updatedAt

  @@unique([paperId, questionNo])
  @@index([paperId])
  @@index([keyStatus])
}

model omr_submissions {
  id                String       @id @default(cuid())
  paperId           String
  paper             omr_papers   @relation(fields: [paperId], references: [id])

  studentName       String
  studentPhone      String
  studentEmail      String?
  studentClass      String
  studentRollNo     String?

  submittedAnswers  Json
  omrImageUrl       String?
  useVerifiedKey    Boolean      @default(false)

  totalAttempted    Int          @default(0)
  totalCorrect      Int          @default(0)
  totalWrong        Int          @default(0)
  totalUnattempted  Int          @default(0)
  marksObtained     Float        @default(0)
  maxMarks          Float
  percentage        Float        @default(0)

  sectionResults    Json?
  questionResults   Json?

  rank              Int?
  percentile        Float?

  status            String       @default("completed")
  submittedAt       DateTime     @default(now())
  recalculatedAt    DateTime?

  ipAddress         String?
  userAgent         String?

  createdAt         DateTime     @default(now())

  @@index([paperId])
  @@index([studentPhone])
  @@index([studentClass])
  @@index([submittedAt])
  @@index([paperId, percentage])
}
