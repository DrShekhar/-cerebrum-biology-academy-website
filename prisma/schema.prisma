generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_DATABASE_URL")
}

model achievements {
  id              String          @id
  freeUserId      String
  type            AchievementType
  title           String
  description     String
  icon            String?
  points          Int             @default(0)
  currentProgress Int             @default(0)
  targetProgress  Int             @default(1)
  isCompleted     Boolean         @default(false)
  earnedAt        DateTime?
  createdAt       DateTime        @default(now())
  free_users      free_users      @relation(fields: [freeUserId], references: [id], onDelete: Cascade)
}

model activities {
  id          String   @id
  userId      String
  leadId      String?
  action      String
  description String
  metadata    Json?
  createdAt   DateTime @default(now())
  leads       leads?   @relation(fields: [leadId], references: [id], onDelete: Cascade)
  users       users    @relation(fields: [userId], references: [id])

  @@index([createdAt])
  @@index([leadId])
  @@index([userId, createdAt])
}

model agent_tasks {
  id                 String              @id
  agentType          AgentType
  leadId             String?
  communicationId    String?
  status             AgentTaskStatus     @default(PENDING)
  input              Json
  output             Json?
  error              String?
  scheduledAt        DateTime?
  startedAt          DateTime?
  completedAt        DateTime?
  attempt            Int                 @default(0)
  maxAttempts        Int                 @default(3)
  metadata           Json?
  createdAt          DateTime            @default(now())
  updatedAt          DateTime
  crm_communications crm_communications? @relation(fields: [communicationId], references: [id], onDelete: Cascade)
  leads              leads?              @relation(fields: [leadId], references: [id], onDelete: Cascade)

  @@index([agentType, status])
  @@index([communicationId])
  @@index([leadId])
  @@index([status, scheduledAt])
}

model analytics_events {
  id          String   @id
  userId      String?
  sessionId   String?
  eventType   String
  eventName   String
  properties  Json?
  pagePath    String?
  pageTitle   String?
  referrer    String?
  userAgent   String?
  utmSource   String?
  utmMedium   String?
  utmCampaign String?
  ipAddress   String?
  country     String?
  city        String?
  createdAt   DateTime @default(now())

  @@index([eventType, createdAt])
  @@index([sessionId])
  @@index([userId, createdAt])
  @@index([utmSource, utmMedium, utmCampaign])
}

model answer_error_reports {
  id                  String               @id
  questionId          String?
  communityQuestionId String?
  reportedBy          String
  reporterName        String?
  reporterPhone       String?
  reporterEmail       String?
  reportType          ErrorReportType
  currentAnswer       String
  suggestedAnswer     String?
  explanation         String
  evidence            String?
  status              ErrorReportStatus    @default(PENDING)
  reviewedBy          String?
  reviewedAt          DateTime?
  resolution          String?
  isValid             Boolean?
  reporterXpAwarded   Int                  @default(0)
  createdAt           DateTime             @default(now())
  community_questions community_questions? @relation(fields: [communityQuestionId], references: [id])

  @@index([communityQuestionId])
  @@index([questionId])
  @@index([status])
}

model assignment_submissions {
  id                String           @id
  assignmentId      String
  studentId         String
  submittedFiles    String[]
  submittedText     String?
  status            SubmissionStatus @default(NOT_SUBMITTED)
  submittedAt       DateTime?
  grade             Int?
  feedback          String?
  gradedAt          DateTime?
  isLate            Boolean          @default(false)
  resubmissionCount Int              @default(0)
  lastResubmittedAt DateTime?
  createdAt         DateTime         @default(now())
  updatedAt         DateTime
  assignments       assignments      @relation(fields: [assignmentId], references: [id], onDelete: Cascade)
  users             users            @relation(fields: [studentId], references: [id], onDelete: Cascade)

  @@unique([assignmentId, studentId])
  @@index([assignmentId, status])
  @@index([status, gradedAt])
  @@index([studentId, status])
  @@index([submittedAt])
}

model assignments {
  id                     String                   @id
  teacherId              String
  courseId               String?
  chapterId              String?
  topicId                String?
  title                  String
  description            String
  instructions           String?
  maxMarks               Int
  dueDate                DateTime
  allowLateSubmission    Boolean                  @default(false)
  allowResubmission      Boolean                  @default(false)
  latePenaltyPercentage  Int                      @default(0)
  status                 AssignmentStatus         @default(DRAFT)
  attachments            String[]
  createdAt              DateTime                 @default(now())
  updatedAt              DateTime
  publishedAt            DateTime?
  assignment_submissions assignment_submissions[]
  chapters               chapters?                @relation(fields: [chapterId], references: [id])
  courses                courses?                 @relation(fields: [courseId], references: [id])
  users                  users                    @relation(fields: [teacherId], references: [id], onDelete: Cascade)
  topics                 topics?                  @relation(fields: [topicId], references: [id])

  @@index([courseId, status])
  @@index([dueDate, status])
  @@index([status, publishedAt])
  @@index([teacherId, status])
}

model attendance_settings {
  id                      String       @id
  courseId                String?      @unique
  enrollmentId            String?      @unique
  autoMarkAbsent          Boolean      @default(true)
  autoMarkAfterMinutes    Int          @default(15)
  lateThresholdMinutes    Int          @default(10)
  minAttendancePercentage Float        @default(75.0)
  allowSelfCheckIn        Boolean      @default(false)
  requireLocation         Boolean      @default(false)
  allowedLocations        Json?
  sendAbsentNotifications Boolean      @default(true)
  sendLateNotifications   Boolean      @default(true)
  parentNotifications     Boolean      @default(true)
  metadata                Json?
  createdAt               DateTime     @default(now())
  updatedAt               DateTime
  courses                 courses?     @relation(fields: [courseId], references: [id], onDelete: Cascade)
  enrollments             enrollments? @relation(fields: [enrollmentId], references: [id], onDelete: Cascade)

  @@index([courseId])
  @@index([enrollmentId])
}

model batches {
  id              String         @id
  classType       BatchClassType
  batchNumber     Int
  days            String[]
  startTime       String
  endTime         String
  offlineLocation BatchLocation
  hasOnline       Boolean        @default(true)
  status          BatchStatus    @default(AVAILABLE)
  displayOrder    Int            @default(0)
  isActive        Boolean        @default(true)
  createdAt       DateTime       @default(now())
  updatedAt       DateTime

  @@unique([classType, batchNumber])
  @@index([classType, status])
  @@index([offlineLocation])
}

model biology_topics {
  id              String          @id
  title           String
  slug            String          @unique
  content         String
  excerpt         String?
  metaTitle       String?
  metaDescription String?
  keywords        String[]
  curriculum      String
  grade           String
  chapter         String
  difficulty      String          @default("Medium")
  keyPoints       Json?
  diagrams        Json?
  videoUrl        String?
  leadMagnetId    String?
  viewCount       Int             @default(0)
  leadConversions Int             @default(0)
  avgTimeOnPage   Int?
  bounceRate      Float?
  isPublished     Boolean         @default(false)
  publishedAt     DateTime?
  authorName      String?         @default("Dr. Shekhar C Singh")
  createdAt       DateTime        @default(now())
  updatedAt       DateTime
  lead_magnets    lead_magnets?   @relation(fields: [leadMagnetId], references: [id])
  content_leads   content_leads[]

  @@index([curriculum, grade, chapter])
  @@index([isPublished, publishedAt])
  @@index([slug])
  @@index([viewCount])
}

model blog_views {
  id        String   @id
  slug      String   @unique
  views     Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([slug])
  @@index([views])
}

model bookmarks {
  id            String        @id
  freeUserId    String
  chapterNoteId String
  notes         String?
  createdAt     DateTime      @default(now())
  chapter_notes chapter_notes @relation(fields: [chapterNoteId], references: [id], onDelete: Cascade)
  free_users    free_users    @relation(fields: [freeUserId], references: [id], onDelete: Cascade)

  @@unique([freeUserId, chapterNoteId])
}

model certificate_templates {
  id              String          @id
  name            String
  description     String?
  templateType    CertificateType @default(COURSE_COMPLETION)
  designType      DesignType      @default(MODERN)
  primaryColor    String          @default("#2563eb")
  secondaryColor  String          @default("#1e40af")
  accentColor     String          @default("#dbeafe")
  fontFamily      String          @default("Inter")
  layout          Json
  backgroundImage String?
  logoUrl         String?
  signatureFields Json
  customFields    Json?
  isActive        Boolean         @default(true)
  isDefault       Boolean         @default(false)
  usageCount      Int             @default(0)
  createdBy       String?
  createdAt       DateTime        @default(now())
  updatedAt       DateTime
  certificates    certificates[]

  @@index([isDefault])
  @@index([templateType, isActive])
}

model certificates {
  id                    String                 @id
  studentId             String
  courseId              String?
  enrollmentId          String?
  templateId            String?
  certificateType       CertificateType        @default(COURSE_COMPLETION)
  certificateNumber     String                 @unique
  verificationCode      String                 @unique
  studentName           String
  courseName            String
  completionDate        DateTime
  issueDate             DateTime               @default(now())
  validUntil            DateTime?
  grade                 String?
  percentage            Float?
  duration              String?
  instructorNames       Json?
  achievements          Json?
  qrCodeUrl             String?
  certificatePdfUrl     String?
  thumbnailUrl          String?
  status                CertificateStatus      @default(ISSUED)
  revokedAt             DateTime?
  revokedBy             String?
  revokeReason          String?
  downloadCount         Int                    @default(0)
  lastDownloadedAt      DateTime?
  viewCount             Int                    @default(0)
  shareCount            Int                    @default(0)
  metadata              Json?
  createdAt             DateTime               @default(now())
  updatedAt             DateTime
  courses               courses?               @relation(fields: [courseId], references: [id])
  enrollments           enrollments?           @relation(fields: [enrollmentId], references: [id])
  users                 users                  @relation(fields: [studentId], references: [id], onDelete: Cascade)
  certificate_templates certificate_templates? @relation(fields: [templateId], references: [id])

  @@index([certificateNumber])
  @@index([certificateType, status])
  @@index([courseId, status])
  @@index([status, issueDate])
  @@index([studentId, status, issueDate])
  @@index([verificationCode])
}

model chapter_notes {
  id              String      @id
  title           String
  curriculum      String
  grade           String
  subject         String      @default("Biology")
  chapter         String
  topic           String?
  content         String
  summary         String?
  keyPoints       Json?
  diagrams        Json?
  difficulty      String      @default("Medium")
  estimatedTime   Int?
  downloadCount   Int         @default(0)
  viewCount       Int         @default(0)
  rating          Float       @default(0)
  ratingCount     Int         @default(0)
  slug            String      @unique
  metaDescription String?
  tags            Json?
  isPublished     Boolean     @default(false)
  publishedAt     DateTime?
  createdAt       DateTime    @default(now())
  updatedAt       DateTime
  bookmarks       bookmarks[]

  @@index([curriculum, grade, chapter])
  @@index([slug])
}

model chapters {
  id              String            @id
  courseId        String
  title           String
  description     String?
  orderIndex      Int
  isActive        Boolean           @default(true)
  createdAt       DateTime          @default(now())
  updatedAt       DateTime
  assignments     assignments[]
  courses         courses           @relation(fields: [courseId], references: [id], onDelete: Cascade)
  doubt_tickets   doubt_tickets[]
  study_materials study_materials[]
  topics          topics[]

  @@index([courseId, orderIndex])
}

model coupons {
  id                  String               @id @default(cuid())
  code                String               @unique
  description         String?
  discountPercent     Int // Percentage discount (0-100)
  discountAmount      Int? // Fixed amount discount (alternative to percent)
  isActive            Boolean              @default(true)
  startsAt            DateTime?
  expiresAt           DateTime?
  maxUses             Int? // Total max uses
  maxUsesPerUser      Int? // Max uses per user
  usedCount           Int                  @default(0)
  minOrderAmount      Int? // Minimum order amount for coupon to apply
  applicableCourseIds String[] // List of course IDs this coupon applies to (empty = all)
  createdBy           String?
  createdAt           DateTime             @default(now())
  updatedAt           DateTime             @updatedAt
  redemptions         coupon_redemptions[]

  @@index([code])
  @@index([isActive, expiresAt])
}

model coupon_redemptions {
  id             String   @id @default(cuid())
  couponId       String
  userId         String
  orderId        String?
  originalAmount Int
  discountAmount Int
  finalAmount    Int
  createdAt      DateTime @default(now())
  coupon         coupons  @relation(fields: [couponId], references: [id], onDelete: Cascade)
  user           users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([couponId])
  @@index([userId])
  @@index([orderId])
}

model chat_history {
  id              String   @id
  userId          String?
  freeUserId      String?
  sessionId       String
  message         String
  isUserMessage   Boolean
  ncertReferences Json?
  relatedTopics   Json?
  confidence      Int?
  tokensUsed      Int?
  topic           String?
  difficulty      String?
  createdAt       DateTime @default(now())

  @@index([freeUserId, createdAt])
  @@index([sessionId, createdAt])
  @@index([userId, createdAt])
}

model class_sessions {
  id                 String               @id
  courseId           String
  enrollmentId       String?
  title              String
  description        String?
  sessionType        SessionType          @default(REGULAR)
  scheduledDate      DateTime
  startTime          DateTime
  endTime            DateTime
  duration           Int
  teacherId          String
  meetingLink        String?
  meetingId          String?
  meetingPassword    String?
  location           String?
  topic              String?
  chapter            String?
  syllabusCovered    Json?
  status             SessionStatus        @default(SCHEDULED)
  cancelledAt        DateTime?
  cancelReason       String?
  rescheduledFrom    String?
  attendanceMarked   Boolean              @default(false)
  totalStudents      Int                  @default(0)
  presentCount       Int                  @default(0)
  absentCount        Int                  @default(0)
  lateCount          Int                  @default(0)
  recordingUrl       String?
  notesUrl           String?
  materialsUrl       Json?
  homeworkAssigned   String?
  metadata           Json?
  createdAt          DateTime             @default(now())
  updatedAt          DateTime
  courses            courses              @relation(fields: [courseId], references: [id], onDelete: Cascade)
  enrollments        enrollments?         @relation(fields: [enrollmentId], references: [id])
  users              users                @relation(fields: [teacherId], references: [id], onDelete: Cascade)
  student_attendance student_attendance[]

  @@index([courseId, scheduledDate])
  @@index([enrollmentId, scheduledDate])
  @@index([scheduledDate])
  @@index([status, scheduledDate])
  @@index([teacherId, scheduledDate])
}

model communication_logs {
  id                String               @id
  userId            String?
  demoBookingId     String?
  type              CommunicationType
  channel           CommunicationChannel
  content           String
  subject           String?
  status            MessageStatus        @default(SENT)
  sentAt            DateTime             @default(now())
  deliveredAt       DateTime?
  readAt            DateTime?
  whatsappMessageId String?
  emailMessageId    String?
  templateId        String?
  templateData      Json?
  createdAt         DateTime             @default(now())
  demo_bookings     demo_bookings?       @relation(fields: [demoBookingId], references: [id])
  users             users?               @relation(fields: [userId], references: [id])
}

model community_questions {
  id                   String                  @id
  question             String
  options              Json
  correctAnswer        String
  explanation          String?
  topic                String
  subtopic             String?
  chapter              String?
  difficulty           DifficultyLevel         @default(MEDIUM)
  isPYQ                Boolean                 @default(false)
  pyqYear              Int?
  submittedBy          String
  submitterName        String
  submitterPhone       String?
  submitterEmail       String?
  aiScore              Float?
  aiAnalysis           Json?
  aiScreenedAt         DateTime?
  aiApproved           Boolean?
  status               CommunityQuestionStatus @default(PENDING)
  reviewedBy           String?
  reviewedAt           DateTime?
  reviewNotes          String?
  rejectionReason      String?
  totalAttempts        Int                     @default(0)
  correctAttempts      Int                     @default(0)
  reportCount          Int                     @default(0)
  qualityScore         Float?
  contributorXpAwarded Int                     @default(0)
  createdAt            DateTime                @default(now())
  updatedAt            DateTime
  publishedAt          DateTime?
  answer_error_reports answer_error_reports[]

  @@index([isPYQ, pyqYear])
  @@index([status, aiApproved])
  @@index([submittedBy])
  @@index([topic, difficulty])
}

model contact_inquiries {
  id            String          @id
  name          String
  email         String
  phone         String
  center        String?
  supportType   String
  message       String
  source        String          @default("Website")
  status        InquiryStatus   @default(NEW)
  priority      InquiryPriority @default(NORMAL)
  department    String?
  assignedToId  String?
  respondedAt   DateTime?
  resolvedAt    DateTime?
  responseNotes String?
  ipAddress     String?
  userAgent     String?
  utmSource     String?
  utmMedium     String?
  utmCampaign   String?
  createdAt     DateTime        @default(now())
  updatedAt     DateTime
  users         users?          @relation(fields: [assignedToId], references: [id])

  @@index([assignedToId])
  @@index([email])
  @@index([phone])
  @@index([status, createdAt])
  @@index([supportType, createdAt])
}

model content_generation_limits {
  id                String   @id
  month             String   @unique
  blogsGenerated    Int      @default(0)
  newsGenerated     Int      @default(0)
  landingPages      Int      @default(0)
  tokensUsed        Int      @default(0)
  costUsd           Float    @default(0)
  maxMonthlyBlogs   Int      @default(15)
  maxMonthlyNews    Int      @default(30)
  maxMonthlyPages   Int      @default(10)
  maxMonthlyCostUsd Float    @default(5.0)
  createdAt         DateTime @default(now())
  updatedAt         DateTime
}

model content_generation_queue {
  id                String                  @id
  type              ContentGenerationType
  triggerSource     ContentTriggerSource
  priority          ContentPriority         @default(NORMAL)
  status            ContentGenerationStatus @default(PENDING)
  topic             String
  keywords          String[]
  sourceUrl         String?
  additionalContext String?
  generatedTitle    String?
  generatedSlug     String?
  generatedContent  String?
  generatedMeta     Json?
  generatedExcerpt  String?
  whatsappMessageId String?
  approvalSentAt    DateTime?
  approvalResponse  String?
  iterationCount    Int                     @default(0)
  iterationFeedback String?
  publishedUrl      String?
  publishedAt       DateTime?
  tokensUsed        Int?
  costUsd           Float?
  errorMessage      String?
  createdAt         DateTime                @default(now())
  updatedAt         DateTime

  @@index([priority, status])
  @@index([status, createdAt])
  @@index([triggerSource])
  @@index([type, status])
}

model content_leads {
  id                  String          @id
  email               String?
  whatsappNumber      String?
  name                String?
  grade               String?
  interestedIn        String?
  source              String
  topicSlug           String?
  leadMagnetId        String?
  utmSource           String?
  utmMedium           String?
  utmCampaign         String?
  utmContent          String?
  utmTerm             String?
  referrerUrl         String?
  landingPage         String?
  deviceType          String?
  browser             String?
  ipAddress           String?
  country             String?
  city                String?
  downloadCompleted   Boolean         @default(false)
  downloadedAt        DateTime?
  emailVerified       Boolean         @default(false)
  whatsappVerified    Boolean         @default(false)
  convertedToPaid     Boolean         @default(false)
  convertedAt         DateTime?
  enrollmentId        String?
  welcomeEmailSent    Boolean         @default(false)
  welcomeWhatsAppSent Boolean         @default(false)
  followUpCount       Int             @default(0)
  lastContactedAt     DateTime?
  leadScore           Int             @default(0)
  leadStage           String          @default("NEW")
  createdAt           DateTime        @default(now())
  updatedAt           DateTime
  lead_magnets        lead_magnets?   @relation(fields: [leadMagnetId], references: [id])
  biology_topics      biology_topics? @relation(fields: [topicSlug], references: [slug])

  @@index([convertedToPaid])
  @@index([createdAt])
  @@index([email])
  @@index([leadStage, leadScore])
  @@index([source, createdAt])
  @@index([topicSlug, createdAt])
  @@index([whatsappNumber])
}

model content_notifications {
  id              String             @id
  title           String
  message         String
  type            NotificationType
  targetUserIds   Json?
  targetCourseIds Json?
  sendToAll       Boolean            @default(false)
  materialId      String?
  courseId        String?
  channels        Json
  scheduledFor    DateTime?
  sentAt          DateTime?
  status          NotificationStatus @default(DRAFT)
  recipientCount  Int                @default(0)
  deliveredCount  Int                @default(0)
  failedCount     Int                @default(0)
  createdAt       DateTime           @default(now())
  updatedAt       DateTime

  @@index([materialId])
  @@index([status, scheduledFor])
}

model counselor_goals {
  id           String            @id
  counselorId  String
  goalType     CounselorGoalType
  period       GoalPeriod
  targetValue  Decimal           @db.Decimal(12, 2)
  currentValue Decimal           @default(0) @db.Decimal(12, 2)
  startDate    DateTime
  endDate      DateTime
  status       GoalStatus        @default(ACTIVE)
  achievedAt   DateTime?
  progress     Decimal           @default(0) @db.Decimal(5, 2)
  metadata     Json?
  createdAt    DateTime          @default(now())
  updatedAt    DateTime
  users        users             @relation(fields: [counselorId], references: [id], onDelete: Cascade)

  @@index([counselorId, period, status])
  @@index([goalType, period])
  @@index([status, endDate])
}

model counselor_kpis {
  id                     String   @id
  counselorId            String
  date                   DateTime @db.Date
  leadsCreated           Int      @default(0)
  leadsContacted         Int      @default(0)
  leadsConverted         Int      @default(0)
  demosScheduled         Int      @default(0)
  demosCompleted         Int      @default(0)
  demosNoShow            Int      @default(0)
  callsMade              Int      @default(0)
  callDurationTotal      Int      @default(0)
  whatsappsSent          Int      @default(0)
  emailsSent             Int      @default(0)
  avgResponseTime        Int?
  conversionRate         Decimal? @db.Decimal(5, 2)
  followUpsMade          Int      @default(0)
  tasksCompleted         Int      @default(0)
  tasksPending           Int      @default(0)
  revenueGenerated       Decimal  @default(0) @db.Decimal(12, 2)
  enrollmentsGenerated   Int      @default(0)
  avgDealValue           Decimal? @db.Decimal(10, 2)
  newLeads               Int      @default(0)
  qualifiedLeads         Int      @default(0)
  demoScheduledLeads     Int      @default(0)
  demoCompletedLeads     Int      @default(0)
  offerSentLeads         Int      @default(0)
  negotiatingLeads       Int      @default(0)
  enrolledLeads          Int      @default(0)
  lostLeads              Int      @default(0)
  dailyLeadTarget        Int      @default(10)
  weeklyConversionTarget Int      @default(5)
  monthlyRevenueTarget   Decimal  @default(100000) @db.Decimal(12, 2)
  notes                  String?
  metadata               Json?
  createdAt              DateTime @default(now())
  updatedAt              DateTime
  users                  users    @relation(fields: [counselorId], references: [id], onDelete: Cascade)

  @@unique([counselorId, date])
  @@index([conversionRate])
  @@index([counselorId, date(sort: Desc)])
  @@index([date])
  @@index([revenueGenerated])
}

model counselor_leaderboard {
  id              String     @id
  counselorId     String
  period          GoalPeriod
  periodStart     DateTime
  periodEnd       DateTime
  rank            Int
  totalLeads      Int        @default(0)
  conversions     Int        @default(0)
  revenue         Decimal    @default(0) @db.Decimal(12, 2)
  conversionRate  Decimal    @default(0) @db.Decimal(5, 2)
  avgResponseTime Int?
  score           Decimal    @default(0) @db.Decimal(8, 2)
  createdAt       DateTime   @default(now())
  updatedAt       DateTime
  users           users      @relation(fields: [counselorId], references: [id], onDelete: Cascade)

  @@unique([counselorId, period, periodStart])
  @@index([period, periodStart, rank])
  @@index([score])
}

model courses {
  id                      String                    @id
  name                    String
  description             String?
  type                    CourseType
  class                   StudentClass
  duration                Int
  totalFees               Int
  syllabus                Json?
  features                Json?
  isActive                Boolean                   @default(true)
  sortOrder               Int                       @default(0)
  createdAt               DateTime                  @default(now())
  updatedAt               DateTime
  assignments             assignments[]
  attendance_settings     attendance_settings?
  certificates            certificates[]
  chapters                chapters[]
  class_sessions          class_sessions[]
  demo_bookings           demo_bookings[]
  doubt_tickets           doubt_tickets[]
  enrollments             enrollments[]
  product_recommendations product_recommendations[]
  study_materials         study_materials[]
  course_pricing          course_pricing[]

  @@index([class, isActive])
  @@index([isActive, sortOrder])
  @@index([type, isActive])
}

model course_pricing {
  id        String   @id @default(cuid())
  courseId  String
  currency  String // INR, USD, EUR, GBP, AUD, CAD, AED, SGD
  amount    Int // Amount in smallest currency unit (paise, cents)
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  course courses @relation(fields: [courseId], references: [id], onDelete: Cascade)

  @@unique([courseId, currency])
  @@index([currency, isActive])
}

model crm_communications {
  id                String        @id
  leadId            String
  type              CommType
  direction         Direction
  subject           String?
  message           String
  status            CommStatus    @default(PENDING)
  sentById          String
  sentAt            DateTime      @default(now())
  whatsappMessageId String?
  templateName      String?
  callDuration      Int?
  callRecordingUrl  String?
  attachments       String[]
  actionItems       String[]
  callSummary       String?
  callTranscript    String?
  keyTopics         String[]
  sentiment         String?
  summarizedAt      DateTime?
  transcribedAt     DateTime?
  agent_tasks       agent_tasks[]
  leads             leads         @relation(fields: [leadId], references: [id], onDelete: Cascade)
  users             users         @relation(fields: [sentById], references: [id])

  @@index([leadId, sentAt])
  @@index([sentById])
}

model daily_challenges {
  id                String           @id
  date              DateTime         @unique @db.Date
  topic             String?
  questionCount     Int              @default(5)
  difficulty        DifficultyLevel?
  timeLimit         Int?
  questionIds       Json
  xpReward          Int              @default(50)
  bonusXp           Int              @default(25)
  participantCount  Int              @default(0)
  perfectScoreCount Int              @default(0)
  avgScore          Float?
  createdAt         DateTime         @default(now())

  @@index([date])
}

model demo_bookings {
  id                    String               @id
  userId                String?
  courseId              String?
  studentName           String
  email                 String?
  phone                 String
  studentClass          StudentClass?
  preferredDate         String
  preferredTime         String
  message               String?
  status                DemoBookingStatus    @default(PENDING)
  assignedTo            String?
  followUpDate          DateTime?
  remindersSent         Int                  @default(0)
  demoCompleted         Boolean              @default(false)
  demoRating            Int?
  demoFeedback          String?
  convertedToEnrollment Boolean              @default(false)
  source                String?
  utmSource             String?
  utmMedium             String?
  utmCampaign           String?
  createdAt             DateTime             @default(now())
  updatedAt             DateTime
  demoType              DemoType             @default(FREE)
  paymentAmount         Int?
  paymentCompletedAt    DateTime?
  paymentStatus         DemoPaymentStatus    @default(NOT_REQUIRED)
  razorpayOrderId       String?              @unique
  razorpayPaymentId     String?              @unique
  referralCodeUsed      String?
  referralDiscount      Int?
  notificationsSent     Json?                @default("{\"email\": false, \"whatsapp\": false}")
  communication_logs    communication_logs[]
  courses               courses?             @relation(fields: [courseId], references: [id])
  users                 users?               @relation(fields: [userId], references: [id])
  leads                 leads?

  @@index([assignedTo, status])
  @@index([email])
  @@index([phone])
  @@index([preferredDate, status])
  @@index([status, createdAt])
}

model diagram_assets {
  id                String              @id
  name              String
  description       String?
  category          DiagramCategory
  subcategory       String?
  source            DiagramSource
  sourceUrl         String?
  license           String
  attribution       String?
  svgContent        String?
  fileUrl           String?
  thumbnailUrl      String?
  qualityScore      Float               @default(3.0)
  isVerified        Boolean             @default(false)
  verifiedBy        String?
  ncertClass        Int?
  ncertUnit         Int?
  ncertChapter      Int?
  ncertChapterName  String?
  ncertFigureNo     String?
  ncertFigureTitle  String?
  ncertPageNo       Int?
  labeledParts      Json?
  tags              String[]
  keywords          String[]
  usageCount        Int                 @default(0)
  lastUsedAt        DateTime?
  width             Int?
  height            Int?
  fileSize          Int?
  isActive          Boolean             @default(true)
  createdAt         DateTime            @default(now())
  updatedAt         DateTime
  question_diagrams question_diagrams[]

  @@index([category, subcategory])
  @@index([isActive, qualityScore])
  @@index([ncertClass, ncertChapter])
  @@index([source])
  @@index([tags])
}

model doubt_categories {
  id            String          @id
  name          String          @unique
  description   String?
  icon          String?
  color         String?
  sortOrder     Int             @default(0)
  isActive      Boolean         @default(true)
  createdAt     DateTime        @default(now())
  updatedAt     DateTime
  doubt_tickets doubt_tickets[]

  @@index([isActive, sortOrder])
}

model doubt_messages {
  id            String        @id
  doubtId       String
  senderId      String
  message       String
  messageType   MessageType   @default(TEXT)
  attachments   String[]
  isRead        Boolean       @default(false)
  readAt        DateTime?
  metadata      Json?
  createdAt     DateTime      @default(now())
  updatedAt     DateTime
  doubt_tickets doubt_tickets @relation(fields: [doubtId], references: [id], onDelete: Cascade)
  users         users         @relation(fields: [senderId], references: [id], onDelete: Cascade)

  @@index([doubtId, createdAt])
  @@index([isRead])
  @@index([senderId])
}

model doubt_tickets {
  id                                      String            @id
  studentId                               String
  instructorId                            String?
  categoryId                              String?
  subject                                 String
  description                             String
  priority                                DoubtPriority     @default(MEDIUM)
  status                                  DoubtStatus       @default(OPEN)
  attachments                             String[]
  tags                                    String[]
  courseId                                String?
  chapterId                               String?
  topicId                                 String?
  viewCount                               Int               @default(0)
  responseTime                            Int?
  resolvedAt                              DateTime?
  lastMessageAt                           DateTime          @default(now())
  studentRating                           Int?
  studentFeedback                         String?
  createdAt                               DateTime          @default(now())
  updatedAt                               DateTime
  doubt_messages                          doubt_messages[]
  doubt_categories                        doubt_categories? @relation(fields: [categoryId], references: [id])
  chapters                                chapters?         @relation(fields: [chapterId], references: [id])
  courses                                 courses?          @relation(fields: [courseId], references: [id])
  users_doubt_tickets_instructorIdTousers users?            @relation("doubt_tickets_instructorIdTousers", fields: [instructorId], references: [id])
  users_doubt_tickets_studentIdTousers    users             @relation("doubt_tickets_studentIdTousers", fields: [studentId], references: [id], onDelete: Cascade)
  topics                                  topics?           @relation(fields: [topicId], references: [id])

  @@index([categoryId, status])
  @@index([courseId])
  @@index([instructorId, status])
  @@index([lastMessageAt])
  @@index([status, priority, createdAt])
  @@index([studentId, status, createdAt])
}

model enrollments {
  id                  String               @id
  userId              String
  courseId            String
  status              EnrollmentStatus     @default(PENDING)
  enrollmentDate      DateTime             @default(now())
  startDate           DateTime?
  endDate             DateTime?
  totalFees           Int
  paidAmount          Int                  @default(0)
  pendingAmount       Int                  @default(0)
  paymentPlan         PaymentPlan          @default(FULL)
  currentProgress     Int                  @default(0)
  lastAccessDate      DateTime?
  createdAt           DateTime             @default(now())
  updatedAt           DateTime
  attendance_settings attendance_settings?
  certificates        certificates[]
  class_sessions      class_sessions[]
  courses             courses              @relation(fields: [courseId], references: [id])
  users               users                @relation(fields: [userId], references: [id])
  payments            payments[]
  student_attendance  student_attendance[]
  video_progress      video_progress[]

  @@unique([userId, courseId])
  @@index([courseId, status])
  @@index([enrollmentDate])
  @@index([status, createdAt])
  @@index([userId, status])
}

model error_feedback {
  id                String   @id
  errorId           String
  description       String
  email             String?
  reproductionSteps String?
  clientIP          String
  createdAt         DateTime @default(now())

  @@index([createdAt])
  @@index([errorId, createdAt])
}

model error_reports {
  id          String              @id
  fingerprint String
  message     String
  stack       String?
  errorName   String              @default("Error")
  severity    ErrorReportSeverity @default(normal)
  context     Json?
  url         String?
  userAgent   String?
  clientIP    String
  userId      String?
  resolved    Boolean             @default(false)
  resolvedAt  DateTime?
  resolvedBy  String?
  occurrences Int                 @default(1)
  firstSeen   DateTime            @default(now())
  lastSeen    DateTime            @default(now())
  createdAt   DateTime            @default(now())
  updatedAt   DateTime
  users       users?              @relation(fields: [userId], references: [id])

  @@index([clientIP, lastSeen])
  @@index([createdAt])
  @@index([fingerprint, lastSeen])
  @@index([severity, resolved, lastSeen])
  @@index([userId, lastSeen])
}

model fee_payments {
  id                String    @id
  feePlanId         String
  installmentId     String?
  amount            Decimal   @db.Decimal(10, 2)
  paymentMethod     String
  razorpayOrderId   String?
  razorpayPaymentId String?
  razorpaySignature String?
  status            String
  paidAt            DateTime?
  metadata          Json?
  receiptUrl        String?
  createdAt         DateTime  @default(now())
  fee_plans         fee_plans @relation(fields: [feePlanId], references: [id])

  @@index([feePlanId, createdAt])
}

model fee_plans {
  id                   String         @id
  leadId               String
  courseId             String
  courseName           String
  baseFee              Decimal        @db.Decimal(10, 2)
  discount             Decimal        @default(0) @db.Decimal(10, 2)
  discountType         DiscountType   @default(PERCENTAGE)
  totalFee             Decimal        @db.Decimal(10, 2)
  amountPaid           Decimal        @default(0) @db.Decimal(10, 2)
  amountDue            Decimal        @db.Decimal(10, 2)
  planType             String
  numberOfInstallments Int
  status               FeeStatus      @default(PENDING)
  createdById          String
  createdAt            DateTime       @default(now())
  updatedAt            DateTime
  fee_payments         fee_payments[]
  users                users          @relation(fields: [createdById], references: [id])
  leads                leads          @relation(fields: [leadId], references: [id], onDelete: Cascade)
  installments         installments[]

  @@index([createdById])
  @@index([leadId, status])
}

model followup_history {
  id          String         @id
  leadId      String
  ruleId      String?
  action      FollowupAction
  channel     String?
  content     String?
  sentAt      DateTime       @default(now())
  status      String
  metadata    Json?
  createdById String?
  isAutomated Boolean        @default(true)
  users       users?         @relation(fields: [createdById], references: [id])
  leads       leads          @relation(fields: [leadId], references: [id], onDelete: Cascade)

  @@index([isAutomated, sentAt])
  @@index([leadId, sentAt])
  @@index([status])
}

model followup_queue {
  id             String         @id
  leadId         String
  ruleId         String
  scheduledFor   DateTime
  status         QueueStatus    @default(PENDING)
  attempt        Int            @default(0)
  maxAttempts    Int            @default(3)
  lastAttemptAt  DateTime?
  completedAt    DateTime?
  errorMessage   String?
  metadata       Json?
  createdAt      DateTime       @default(now())
  updatedAt      DateTime
  leads          leads          @relation(fields: [leadId], references: [id], onDelete: Cascade)
  followup_rules followup_rules @relation(fields: [ruleId], references: [id])

  @@index([leadId])
  @@index([ruleId])
  @@index([scheduledFor, status])
  @@index([status])
}

model followup_rules {
  id                                      String              @id
  name                                    String
  description                             String?
  isActive                                Boolean             @default(true)
  triggerType                             FollowupTrigger
  triggerConditions                       Json
  delayMinutes                            Int
  actionType                              FollowupAction
  templateId                              String?
  priority                                Priority            @default(WARM)
  assignToCounselor                       Boolean             @default(true)
  createdById                             String
  updatedById                             String?
  createdAt                               DateTime            @default(now())
  updatedAt                               DateTime
  followup_queue                          followup_queue[]
  users_followup_rules_createdByIdTousers users               @relation("followup_rules_createdByIdTousers", fields: [createdById], references: [id])
  followup_templates                      followup_templates? @relation(fields: [templateId], references: [id])
  users_followup_rules_updatedByIdTousers users?              @relation("followup_rules_updatedByIdTousers", fields: [updatedById], references: [id])

  @@index([createdById])
  @@index([isActive, triggerType])
}

model followup_templates {
  id             String           @id
  name           String
  description    String?
  channel        FollowupAction
  subject        String?
  content        String
  variables      Json
  isActive       Boolean          @default(true)
  createdById    String
  createdAt      DateTime         @default(now())
  updatedAt      DateTime
  followup_rules followup_rules[]
  users          users            @relation(fields: [createdById], references: [id])

  @@index([channel, isActive])
  @@index([createdById])
}

model forum_posts {
  id            String          @id
  freeUserId    String
  title         String
  content       String
  topic         String
  type          PostType        @default(QUESTION)
  upvotes       Int             @default(0)
  views         Int             @default(0)
  isResolved    Boolean         @default(false)
  isPinned      Boolean         @default(false)
  createdAt     DateTime        @default(now())
  updatedAt     DateTime
  free_users    free_users      @relation(fields: [freeUserId], references: [id], onDelete: Cascade)
  forum_replies forum_replies[]

  @@index([topic, createdAt])
}

model forum_replies {
  id          String      @id
  postId      String
  content     String
  authorName  String
  upvotes     Int         @default(0)
  isAccepted  Boolean     @default(false)
  createdAt   DateTime    @default(now())
  forum_posts forum_posts @relation(fields: [postId], references: [id], onDelete: Cascade)
}

model free_resources {
  id            String            @id
  title         String
  description   String?
  type          FreeResourceType
  fileUrl       String?
  content       String?
  thumbnailUrl  String?
  classCategory FreeResourceClass
  priority      Int               @default(0)
  isPublished   Boolean           @default(false)
  isArchived    Boolean           @default(false)
  publishedAt   DateTime?
  expiresAt     DateTime?
  viewCount     Int               @default(0)
  createdAt     DateTime          @default(now())
  updatedAt     DateTime

  @@index([classCategory, isPublished])
  @@index([expiresAt])
  @@index([isPublished, priority])
  @@index([type, isPublished, isArchived])
}

model free_users {
  id                       String                     @id
  email                    String                     @unique
  name                     String?
  grade                    String?
  curriculum               String?
  school                   String?
  city                     String?
  totalPoints              Int                        @default(0)
  studyStreak              Int                        @default(0)
  lastActiveDate           DateTime?
  preferences              Json?
  registrationDate         DateTime                   @default(now())
  updatedAt                DateTime
  adaptiveData             Json?
  averageScore             Float?
  bestScore                Float?
  currentLevel             Int                        @default(1)
  strongestTopics          Json?
  totalTestsTaken          Int                        @default(0)
  weakestTopics            Json?
  deviceId                 String?
  extensionCount           Int                        @default(0)
  isTrialExpired           Boolean                    @default(false)
  lastTrialCheck           DateTime                   @default(now())
  testsTakenCount          Int                        @default(0)
  trialExpiryDate          DateTime?
  trialExtended            Boolean                    @default(false)
  trialStartDate           DateTime                   @default(now())
  upgradedToUserId         String?
  achievements             achievements[]
  bookmarks                bookmarks[]
  forum_posts              forum_posts[]
  mcq_bookmarks            mcq_bookmarks[]
  performance_reports      performance_reports[]
  question_review_schedule question_review_schedule[]
  study_plans              study_plans[]
  test_attempts            test_attempts[]
  test_sessions            test_sessions[]
  user_progress            user_progress[]
  user_question_responses  user_question_responses[]

  @@index([deviceId])
  @@index([trialExpiryDate, isTrialExpired])
  @@index([upgradedToUserId])
  @@index([grade, curriculum]) // Filter by grade and curriculum
  @@index([lastActiveDate]) // For active user queries and streaks
  @@index([registrationDate]) // For recent user queries and pagination
  @@index([totalPoints]) // For leaderboard queries
  @@index([studyStreak]) // For streak-based queries
}

model gallery_items {
  id              String          @id @default(cuid())
  cloudflareId    String?         @unique
  type            GalleryItemType @default(PHOTO)
  url             String
  thumbnailUrl    String?
  blurHash        String?
  title           String
  description     String?
  category        GalleryCategory
  tags            String[]
  featured        Boolean         @default(false)
  displayOrder    Int             @default(0)
  aspectRatio     String          @default("4:3")
  width           Int?
  height          Int?
  durationSeconds Int?
  eventDate       DateTime?
  createdAt       DateTime        @default(now())
  updatedAt       DateTime        @updatedAt
  createdBy       String?
  users           users?          @relation(fields: [createdBy], references: [id])

  @@index([category])
  @@index([featured])
  @@index([displayOrder])
  @@index([eventDate])
  @@index([createdAt])
  @@index([type, category])
}

model installments {
  id                String            @id
  feePlanId         String
  installmentNumber Int
  amount            Decimal           @db.Decimal(10, 2)
  dueDate           DateTime
  status            PaymentStatusEnum @default(PENDING)
  paidAt            DateTime?
  paidAmount        Decimal?          @db.Decimal(10, 2)
  razorpayOrderId   String?
  razorpayPaymentId String?
  paymentLink       String?
  remindersSent     Json?             @default("{\"1_day\": false, \"7_days\": false, \"due_date\": false}")
  createdAt         DateTime          @default(now())
  updatedAt         DateTime
  fee_plans         fee_plans         @relation(fields: [feePlanId], references: [id], onDelete: Cascade)

  @@index([feePlanId, dueDate])
  @@index([status, dueDate])
}

model lead_magnets {
  id               String           @id
  title            String
  description      String
  fileType         String
  fileUrl          String?
  fileSize         Int?
  thumbnailUrl     String?
  requiresEmail    Boolean          @default(true)
  requiresWhatsApp Boolean          @default(false)
  requiresName     Boolean          @default(true)
  features         Json?
  previewPages     Int?
  downloadCount    Int              @default(0)
  conversionRate   Float?
  isActive         Boolean          @default(true)
  createdAt        DateTime         @default(now())
  updatedAt        DateTime
  biology_topics   biology_topics[]
  content_leads    content_leads[]
}

model leads {
  id                      String                    @id
  studentName             String
  email                   String?
  phone                   String
  courseInterest          String
  stage                   LeadStage                 @default(NEW_LEAD)
  priority                Priority                  @default(WARM)
  assignedToId            String
  createdAt               DateTime                  @default(now())
  updatedAt               DateTime
  lastContactedAt         DateTime?
  nextFollowUpAt          DateTime?
  convertedAt             DateTime?
  lostAt                  DateTime?
  lostReason              String?
  demoBookingId           String?                   @unique
  source                  LeadSource                @default(MANUAL_ENTRY)
  score                   Int?
  scoreBreakdown          Json?
  scoreUpdatedAt          DateTime?
  activities              activities[]
  agent_tasks             agent_tasks[]
  crm_communications      crm_communications[]
  fee_plans               fee_plans[]
  followup_history        followup_history[]
  followup_queue          followup_queue[]
  users                   users                     @relation(fields: [assignedToId], references: [id])
  demo_bookings           demo_bookings?            @relation(fields: [demoBookingId], references: [id])
  notes                   notes[]
  offers                  offers[]
  product_recommendations product_recommendations[]
  tasks                   tasks[]
  whatsapp_conversations  whatsapp_conversations[]

  @@index([assignedToId, score])
  @@index([assignedToId, stage])
  @@index([createdAt])
  @@index([email])
  @@index([nextFollowUpAt])
  @@index([phone])
  @@index([score])
}

model lms_device_sessions {
  id                  String                @id
  userId              String
  deviceId            String
  deviceName          String?
  deviceType          DeviceType
  browser             String?
  os                  String?
  ipAddress           String?
  country             String?
  city                String?
  isActive            Boolean               @default(true)
  lastActiveAt        DateTime              @default(now())
  firstSeenAt         DateTime              @default(now())
  isTrusted           Boolean               @default(false)
  trustVerifiedAt     DateTime?
  sessionToken        String                @unique
  expiresAt           DateTime?
  isRevoked           Boolean               @default(false)
  revokedAt           DateTime?
  revokedReason       String?
  metadata            Json?
  createdAt           DateTime              @default(now())
  updatedAt           DateTime
  users               users                 @relation(fields: [userId], references: [id], onDelete: Cascade)
  lms_security_events lms_security_events[]

  @@index([deviceId])
  @@index([lastActiveAt])
  @@index([sessionToken])
  @@index([userId, isActive])
}

model lms_progress_notifications {
  id               String              @id
  userId           String
  notificationType LmsNotificationType
  title            String
  message          String
  courseId         String?
  videoLectureId   String?
  sentVia          String[]
  sentAt           DateTime?
  readAt           DateTime?
  clickedAt        DateTime?
  scheduledFor     DateTime?
  metadata         Json?
  createdAt        DateTime            @default(now())
  users            users               @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([notificationType, sentAt])
  @@index([scheduledFor])
  @@index([userId, createdAt])
}

model lms_security_events {
  id                  String               @id
  userId              String?
  videoLectureId      String?
  deviceSessionId     String?
  eventType           LmsSecurityEvent
  severity            SecuritySeverity     @default(LOW)
  description         String
  ipAddress           String?
  userAgent           String?
  deviceFingerprint   String?
  evidence            Json?
  actionTaken         String?
  isResolved          Boolean              @default(false)
  resolvedAt          DateTime?
  resolvedBy          String?
  createdAt           DateTime             @default(now())
  lms_device_sessions lms_device_sessions? @relation(fields: [deviceSessionId], references: [id])
  users               users?               @relation(fields: [userId], references: [id])
  video_lectures      video_lectures?      @relation(fields: [videoLectureId], references: [id])

  @@index([createdAt])
  @@index([eventType, severity])
  @@index([userId, createdAt])
  @@index([videoLectureId])
}

model lms_whatsapp_sessions {
  id                   String            @id
  userId               String            @unique
  phone                String
  currentState         LmsWhatsAppState  @default(MAIN_MENU)
  contextData          Json?
  previousState        LmsWhatsAppState?
  navigationPath       Json?
  lastCourseId         String?
  lastChapterId        String?
  lastVideoId          String?
  lastInteractionAt    DateTime          @default(now())
  totalInteractions    Int               @default(0)
  preferredLanguage    String            @default("en")
  notificationsEnabled Boolean           @default(true)
  createdAt            DateTime          @default(now())
  updatedAt            DateTime
  users                users             @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([currentState])
  @@index([lastInteractionAt])
  @@index([phone])
}

model material_access {
  id              String          @id
  materialId      String
  userId          String
  grantedBy       String
  grantedAt       DateTime        @default(now())
  expiresAt       DateTime?
  reason          String?
  study_materials study_materials @relation(fields: [materialId], references: [id], onDelete: Cascade)
  users           users           @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([materialId, userId])
  @@index([userId])
}

model material_progress {
  id              String          @id
  materialId      String
  userId          String
  status          ProgressStatus  @default(NOT_STARTED)
  firstViewedAt   DateTime?
  lastViewedAt    DateTime?
  downloadedAt    DateTime?
  completedAt     DateTime?
  currentPage     Int?
  totalPages      Int?
  timeSpent       Int             @default(0)
  rating          Int?
  feedback        String?
  notes           String?
  createdAt       DateTime        @default(now())
  updatedAt       DateTime
  study_materials study_materials @relation(fields: [materialId], references: [id], onDelete: Cascade)
  users           users           @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@unique([materialId, userId])
  @@index([materialId, updatedAt])
  @@index([userId, status])
}

model mcq_badges {
  id            String        @id
  code          String        @unique
  name          String
  description   String
  icon          String
  category      BadgeCategory
  requirement   Json
  xpReward      Int           @default(0)
  rarity        BadgeRarity   @default(COMMON)
  totalUnlocked Int           @default(0)
  isActive      Boolean       @default(true)
  createdAt     DateTime      @default(now())
}

model mcq_bookmarks {
  id         String     @id
  freeUserId String
  questionId String
  note       String?
  createdAt  DateTime   @default(now())
  free_users free_users @relation(fields: [freeUserId], references: [id], onDelete: Cascade)
  questions  questions  @relation(fields: [questionId], references: [id], onDelete: Cascade)

  @@unique([freeUserId, questionId])
  @@index([freeUserId])
  @@index([questionId])
}

model mcq_leaderboard {
  id                String            @id
  period            LeaderboardPeriod
  periodStart       DateTime
  periodEnd         DateTime
  rankings          Json
  totalParticipants Int
  topScore          Int
  avgScore          Float?
  createdAt         DateTime          @default(now())

  @@index([period, periodStart])
}

model mcq_practice_sessions {
  id                 String           @id
  freeUserId         String?
  userId             String?
  sessionToken       String?
  topic              String?
  difficulty         DifficultyLevel?
  isPYQOnly          Boolean          @default(false)
  pyqYear            Int?
  questionsAttempted Int              @default(0)
  correctAnswers     Int              @default(0)
  timeSpent          Int              @default(0)
  xpEarned           Int              @default(0)
  leadCaptured       Boolean          @default(false)
  capturedAt         DateTime?
  deviceFingerprint  String?
  ipAddress          String?
  userAgent          String?
  startedAt          DateTime         @default(now())
  endedAt            DateTime?

  @@index([freeUserId])
  @@index([startedAt])
}

model mcq_user_stats {
  id                      String    @id
  freeUserId              String?   @unique
  userId                  String?   @unique
  totalQuestions          Int       @default(0)
  correctAnswers          Int       @default(0)
  accuracy                Float     @default(0)
  currentStreak           Int       @default(0)
  longestStreak           Int       @default(0)
  lastPracticeDate        DateTime?
  totalXp                 Int       @default(0)
  currentLevel            Int       @default(1)
  levelProgress           Float     @default(0)
  dailyChallengeCompleted Boolean   @default(false)
  dailyChallengeDate      DateTime?
  dailyChallengesTotal    Int       @default(0)
  questionsSubmitted      Int       @default(0)
  questionsApproved       Int       @default(0)
  errorsReported          Int       @default(0)
  errorsAccepted          Int       @default(0)
  contributorRank         String?
  topicMastery            Json?
  weakTopics              Json?
  strongTopics            Json?
  badges                  Json?
  createdAt               DateTime  @default(now())
  updatedAt               DateTime

  @@index([currentStreak])
  @@index([totalXp])
}

model message_templates {
  id          String   @id
  name        String
  type        CommType
  subject     String?
  message     String
  isActive    Boolean  @default(true)
  usageCount  Int      @default(0)
  createdById String
  createdAt   DateTime @default(now())
  updatedAt   DateTime
  users       users    @relation(fields: [createdById], references: [id])

  @@index([type, isActive])
}

model ncert_chapters {
  id                  String   @id
  class               Int
  unitNo              Int
  unitName            String
  chapterNo           Int
  chapterName         String
  keyFigures          Json?
  topics              String[]
  neetWeightage       Int      @default(1)
  avgQuestionsPerYear Float?
  createdAt           DateTime @default(now())

  @@unique([class, chapterNo])
  @@index([class])
}

model neet_classes {
  id          String         @id
  classType   BatchClassType @unique
  optionADay  String
  optionATime String
  optionBDay  String
  optionBTime String
  isActive    Boolean        @default(true)
  createdAt   DateTime       @default(now())
  updatedAt   DateTime
}

model newsletterSubscriber {
  id        String   @id
  email     String   @unique
  status    String   @default("active")
  source    String?
  createdAt DateTime @default(now())
  updatedAt DateTime

  @@index([createdAt])
  @@index([status])
}

model notes {
  id          String   @id
  leadId      String
  content     String
  createdById String
  createdAt   DateTime @default(now())
  updatedAt   DateTime
  users       users    @relation(fields: [createdById], references: [id])
  leads       leads    @relation(fields: [leadId], references: [id], onDelete: Cascade)

  @@index([leadId, createdAt])
}

model offers {
  id              String       @id
  leadId          String
  offerCode       String       @unique
  offerName       String
  courseName      String
  originalPrice   Decimal      @db.Decimal(10, 2)
  discountType    DiscountType
  discountValue   Decimal      @db.Decimal(10, 2)
  finalPrice      Decimal      @db.Decimal(10, 2)
  validFrom       DateTime     @default(now())
  validUntil      DateTime
  isActive        Boolean      @default(true)
  status          OfferStatus  @default(SENT)
  sentAt          DateTime     @default(now())
  viewedAt        DateTime?
  acceptedAt      DateTime?
  termsConditions String?
  maxUses         Int          @default(1)
  usesCount       Int          @default(0)
  createdById     String
  offerCardUrl    String?
  createdAt       DateTime     @default(now())
  users           users        @relation(fields: [createdById], references: [id])
  leads           leads        @relation(fields: [leadId], references: [id], onDelete: Cascade)

  @@index([createdById])
  @@index([leadId, status])
  @@index([validUntil])
}

model omr_answer_keys {
  id               String             @id
  paperId          String
  questionNo       Int
  section          String?
  correctAnswer    String
  explanation      String?
  topic            String?
  subtopic         String?
  difficulty       String?
  keyStatus        OMRAnswerKeyStatus @default(UNVERIFIED)
  verifiedBy       String?
  verifiedAt       DateTime?
  verificationNote String?
  previousAnswer   String?
  changedAt        DateTime?
  changedReason    String?
  createdAt        DateTime           @default(now())
  updatedAt        DateTime
  omr_papers       omr_papers         @relation(fields: [paperId], references: [id], onDelete: Cascade)

  @@unique([paperId, questionNo])
  @@index([keyStatus])
  @@index([paperId])
}

model omr_papers {
  id                    String            @id
  paperCode             String            @unique
  title                 String
  description           String?
  subjectType           OMRSubjectType
  targetClass           String
  totalQuestions        Int
  totalMarks            Float
  marksPerCorrect       Float             @default(4)
  marksPerWrong         Float             @default(-1)
  marksPerUnattempted   Float             @default(0)
  sections              Json?
  examDate              DateTime
  submissionStart       DateTime
  submissionEnd         DateTime
  hasVerifiedKey        Boolean           @default(false)
  verifiedKeyUploadedAt DateTime?
  status                OMRPaperStatus    @default(DRAFT)
  isActive              Boolean           @default(true)
  createdBy             String?
  createdAt             DateTime          @default(now())
  updatedAt             DateTime
  omr_answer_keys       omr_answer_keys[]
  omr_submissions       omr_submissions[]

  @@index([examDate])
  @@index([paperCode])
  @@index([subjectType, status])
  @@index([targetClass, status])
}

model omr_submissions {
  id               String     @id
  paperId          String
  studentName      String
  studentPhone     String
  studentEmail     String?
  studentClass     String
  studentRollNo    String?
  submittedAnswers Json
  omrImageUrl      String?
  useVerifiedKey   Boolean    @default(false)
  totalAttempted   Int        @default(0)
  totalCorrect     Int        @default(0)
  totalWrong       Int        @default(0)
  totalUnattempted Int        @default(0)
  marksObtained    Float      @default(0)
  maxMarks         Float
  percentage       Float      @default(0)
  sectionResults   Json?
  questionResults  Json?
  rank             Int?
  percentile       Float?
  status           String     @default("completed")
  submittedAt      DateTime   @default(now())
  recalculatedAt   DateTime?
  ipAddress        String?
  userAgent        String?
  createdAt        DateTime   @default(now())
  omr_papers       omr_papers @relation(fields: [paperId], references: [id])

  @@index([paperId])
  @@index([paperId, percentage])
  @@index([studentClass])
  @@index([studentPhone])
  @@index([submittedAt])
}

model otp_verifications {
  id        String   @id
  mobile    String
  otp       String
  purpose   String
  verified  Boolean  @default(false)
  expiresAt DateTime
  attempts  Int      @default(0)
  createdAt DateTime @default(now())
  updatedAt DateTime

  @@index([expiresAt])
  @@index([mobile, createdAt])
  @@index([mobile])
}

// Email verification tokens for user signup
model email_verification_tokens {
  id        String   @id @default(uuid())
  userId    String
  email     String
  token     String   @unique
  expiresAt DateTime
  verified  Boolean  @default(false)
  createdAt DateTime @default(now())

  user users @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([token])
  @@index([userId])
  @@index([email])
  @@index([expiresAt])
}

// Password reset tokens for forgot password flow
model password_reset_tokens {
  id        String   @id @default(uuid())
  userId    String
  email     String
  token     String   @unique
  expiresAt DateTime
  used      Boolean  @default(false)
  createdAt DateTime @default(now())

  user users @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([token])
  @@index([userId])
  @@index([email])
  @@index([expiresAt])
}

model parent_child_relationships {
  id                                               String   @id
  parentId                                         String
  childId                                          String
  createdAt                                        DateTime @default(now())
  users_parent_child_relationships_childIdTousers  users    @relation("parent_child_relationships_childIdTousers", fields: [childId], references: [id], onDelete: Cascade)
  users_parent_child_relationships_parentIdTousers users    @relation("parent_child_relationships_parentIdTousers", fields: [parentId], references: [id], onDelete: Cascade)

  @@unique([parentId, childId])
  @@index([childId])
  @@index([parentId])
}

model payments {
  id                String        @id
  userId            String
  enrollmentId      String?
  amount            Int
  currency          String        @default("INR")
  status            PaymentStatus @default(PENDING)
  paymentMethod     PaymentMethod
  razorpayOrderId   String?       @unique
  razorpayPaymentId String?       @unique
  razorpaySignature String?
  transactionId     String?
  failureReason     String?
  refundAmount      Int? // Amount refunded (partial or full)
  refundReason      String? // Reason for refund
  refundedAt        DateTime? // When refund was processed
  installmentNumber Int?
  totalInstallments Int?
  createdAt         DateTime      @default(now())
  updatedAt         DateTime
  completedAt       DateTime?
  enrollments       enrollments?  @relation(fields: [enrollmentId], references: [id])
  users             users         @relation(fields: [userId], references: [id])

  @@index([createdAt])
  @@index([enrollmentId, status])
  @@index([status, completedAt])
  @@index([userId, status])
}

model pdf_sync_data {
  id              String         @id
  videoLectureId  String
  videoTimestamp  Int
  pdfPage         Int
  sectionTitle    String?
  description     String?
  isAutoGenerated Boolean        @default(false)
  confidence      Decimal?       @db.Decimal(3, 2)
  createdAt       DateTime       @default(now())
  video_lectures  video_lectures @relation(fields: [videoLectureId], references: [id], onDelete: Cascade)

  @@unique([videoLectureId, videoTimestamp])
  @@index([videoLectureId, pdfPage])
}

model performance_reports {
  id              String      @id
  userId          String?
  freeUserId      String?
  reportType      ReportType  @default(WEEKLY)
  reportPeriod    String
  testsAttempted  Int         @default(0)
  averageScore    Float?
  totalStudyTime  Int         @default(0)
  improvementRate Float?
  biologyScore    Float?
  botanyScore     Float?
  zoologyScore    Float?
  strongTopics    Json?
  weakTopics      Json?
  improvingTopics Json?
  targetScore     Float?
  targetDate      DateTime?
  onTrackStatus   Boolean     @default(true)
  studyPlan       Json?
  focusAreas      Json?
  practiceTests   Json?
  periodStart     DateTime
  periodEnd       DateTime
  generatedAt     DateTime    @default(now())
  free_users      free_users? @relation(fields: [freeUserId], references: [id])
  users           users?      @relation(fields: [userId], references: [id])

  @@unique([freeUserId, reportType, reportPeriod])
  @@unique([userId, reportType, reportPeriod])
  @@index([reportType, periodStart])
}

model product_recommendations {
  id              String    @id
  leadId          String?
  userId          String?
  courseId        String
  matchScore      Int
  matchReasons    Json
  offerSuggestion Json?
  recommendedAt   DateTime  @default(now())
  viewedAt        DateTime?
  clickedAt       DateTime?
  convertedAt     DateTime?
  source          String    @default("AGENT")
  metadata        Json?
  createdAt       DateTime  @default(now())
  courses         courses   @relation(fields: [courseId], references: [id], onDelete: Cascade)
  leads           leads?    @relation(fields: [leadId], references: [id], onDelete: Cascade)
  users           users?    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([courseId])
  @@index([leadId])
  @@index([recommendedAt])
  @@index([userId])
}

model question_bank_questions {
  id             String          @id
  questionBankId String
  questionId     String
  testTemplateId String?
  orderIndex     Int
  groupLabel     String?
  question_banks question_banks  @relation(fields: [questionBankId], references: [id], onDelete: Cascade)
  questions      questions       @relation(fields: [questionId], references: [id], onDelete: Cascade)
  test_templates test_templates? @relation(fields: [testTemplateId], references: [id])

  @@unique([questionBankId, questionId])
  @@index([questionBankId, orderIndex])
}

model question_banks {
  id                      String                    @id
  name                    String
  description             String?
  category                QuestionBankCategory      @default(CUSTOM)
  curriculum              String
  grade                   String
  subject                 String                    @default("biology")
  topics                  Json?
  totalQuestions          Int                       @default(0)
  activeQuestions         Int                       @default(0)
  usageCount              Int                       @default(0)
  isActive                Boolean                   @default(true)
  isPublic                Boolean                   @default(false)
  createdAt               DateTime                  @default(now())
  updatedAt               DateTime
  createdBy               String?
  question_bank_questions question_bank_questions[]
}

model question_diagrams {
  id               String         @id
  questionId       String
  diagramId        String
  position         String         @default("inline")
  caption          String?
  highlightedParts String[]
  markedLabel      String?
  createdAt        DateTime       @default(now())
  diagram_assets   diagram_assets @relation(fields: [diagramId], references: [id], onDelete: Cascade)
  questions        questions      @relation(fields: [questionId], references: [id], onDelete: Cascade)

  @@unique([questionId, diagramId])
  @@index([diagramId])
}

model question_review_schedule {
  id           String     @id
  freeUserId   String
  questionId   String
  easeFactor   Float      @default(2.5)
  interval     Int        @default(1)
  repetitions  Int        @default(0)
  nextReviewAt DateTime
  lastReviewAt DateTime?
  createdAt    DateTime   @default(now())
  updatedAt    DateTime
  free_users   free_users @relation(fields: [freeUserId], references: [id], onDelete: Cascade)
  questions    questions  @relation(fields: [questionId], references: [id], onDelete: Cascade)

  @@unique([freeUserId, questionId])
  @@index([freeUserId, nextReviewAt])
  @@index([questionId])
}

model questions {
  id                        String                      @id
  topic                     String
  subtopic                  String?
  curriculum                String
  grade                     String
  type                      QuestionType
  question                  String
  options                   Json?
  correctAnswer             String
  explanation               String?
  source                    String?
  marks                     Int                         @default(1)
  timeLimit                 Int?
  tags                      Json?
  totalAttempts             Int                         @default(0)
  correctAttempts           Int                         @default(0)
  averageTime               Int?
  isActive                  Boolean                     @default(true)
  isVerified                Boolean                     @default(false)
  createdAt                 DateTime                    @default(now())
  updatedAt                 DateTime
  category                  QuestionCategory            @default(PRACTICE)
  conversionRate            Float?
  difficultyRating          Float?
  examYear                  Int?
  explanationImage          String?
  keywords                  Json?
  lastUsed                  DateTime?
  popularityScore           Float                       @default(0)
  qualityScore              Float?
  questionImage             String?
  relatedConcepts           Json?
  reportCount               Int                         @default(0)
  slug                      String?                     @unique
  solutionSteps             Json?
  subject                   String                      @default("biology")
  variantId                 String?
  verifiedBy                String?
  videoExplanation          String?
  difficulty                DifficultyLevel             @default(MEDIUM)
  isNcertBased              Boolean                     @default(false)
  isNeetImportant           Boolean                     @default(false)
  ncertChapter              Int?
  ncertChapterName          String?
  ncertClass                Int?
  ncertFigure               String?
  ncertPage                 Int?
  neetWeightage             String?
  isOlympiad                Boolean                     @default(false)
  olympiadLevel             String?
  campbellChapter           Int?
  campbellEdition           Int?
  campbellUnit              Int?
  conceptualDepth           String?
  sourceTextbook            String?
  dataContext               String?
  experimentContext         String?
  mcq_bookmarks             mcq_bookmarks[]
  question_bank_questions   question_bank_questions[]
  question_diagrams         question_diagrams[]
  question_review_schedule  question_review_schedule[]
  test_assignment_questions test_assignment_questions[]
  test_questions            test_questions[]
  user_question_responses   user_question_responses[]

  @@index([curriculum, grade])
  @@index([isActive, isVerified])
  @@index([isNcertBased, ncertClass, ncertChapter])
  @@index([neetWeightage])
  @@index([popularityScore])
  @@index([subject, type])
  @@index([topic, difficulty])
  @@index([isOlympiad, olympiadLevel])
  @@index([campbellChapter])
  @@index([campbellUnit, campbellChapter])
}

model quiz_message_reactions {
  id            String        @id @default(cuid())
  messageId     String
  participantId String
  emoji         String
  createdAt     DateTime      @default(now())
  quiz_messages quiz_messages @relation(fields: [messageId], references: [id], onDelete: Cascade)

  @@unique([messageId, participantId, emoji])
  @@index([messageId])
}

model quiz_messages {
  id                     String                   @id @default(cuid())
  sessionId              String
  team                   QuizTeam
  participantId          String
  senderName             String
  message                String
  createdAt              DateTime                 @default(now())
  quiz_message_reactions quiz_message_reactions[]
  quiz_participants      quiz_participants        @relation(fields: [participantId], references: [id], onDelete: Cascade)
  quiz_sessions          quiz_sessions            @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@index([participantId])
  @@index([sessionId, team, createdAt])
}

model quiz_participants {
  id            String          @id @default(cuid())
  sessionId     String
  name          String
  team          QuizTeam?
  isHost        Boolean         @default(false)
  deviceId      String?
  joinedAt      DateTime        @default(now())
  lastSeenAt    DateTime        @default(now())
  quiz_messages quiz_messages[]
  quiz_sessions quiz_sessions   @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@unique([sessionId, name])
  @@index([sessionId])
}

model quiz_rounds {
  id            String        @id @default(cuid())
  sessionId     String
  roundNumber   Int
  answeringTeam QuizTeam
  outcome       RoundOutcome
  pointsChange  Int
  note          String?
  createdAt     DateTime      @default(now())
  quiz_sessions quiz_sessions @relation(fields: [sessionId], references: [id], onDelete: Cascade)

  @@unique([sessionId, roundNumber])
  @@index([sessionId])
}

model quiz_sessions {
  id                   String              @id @default(cuid())
  roomCode             String              @unique @db.VarChar(6)
  title                String
  format               QuizFormat
  questionMode         QuizQuestionMode
  status               QuizSessionStatus   @default(WAITING)
  createdById          String
  teamAName            String              @default("Team A")
  teamBName            String              @default("Team B")
  teamAScore           Int                 @default(0)
  teamBScore           Int                 @default(0)
  currentRound         Int                 @default(0)
  totalRounds          Int?
  scoringRules         Json                @default("{\"pass\": -10, \"wrong\": -10, \"correct\": 20}")
  startedAt            DateTime?
  endedAt              DateTime?
  createdAt            DateTime            @default(now())
  updatedAt            DateTime            @updatedAt
  winner               QuizWinner?
  hostToken            String              @db.VarChar(64)
  activeTimerType      String?
  answerTimerSeconds   Int                 @default(60)
  questionTimerSeconds Int                 @default(60)
  teamDiscussing       String?
  timerPausedAt        DateTime?
  timerStartedAt       DateTime?
  quiz_messages        quiz_messages[]
  quiz_participants    quiz_participants[]
  quiz_rounds          quiz_rounds[]

  @@index([createdById])
  @@index([roomCode])
  @@index([status, createdAt])
}

model referral_codes {
  id                   String                 @id
  code                 String                 @unique
  userId               String?
  userEmail            String
  uses                 Int                    @default(0)
  maxUses              Int                    @default(10)
  discount             Int
  expiresAt            DateTime?
  createdAt            DateTime               @default(now())
  referral_redemptions referral_redemptions[]

  @@index([code])
  @@index([userEmail])
}

model referral_redemptions {
  id              String         @id
  referralCodeId  String
  redeemedBy      String
  redeemedByEmail String
  discountGiven   Int
  bookingId       String?
  createdAt       DateTime       @default(now())
  referral_codes  referral_codes @relation(fields: [referralCodeId], references: [id], onDelete: Cascade)

  @@index([redeemedByEmail])
  @@index([referralCodeId])
}

model reschedule_tokens {
  id        String   @id
  bookingId String   @unique
  token     String   @unique
  expiresAt DateTime
  used      Boolean  @default(false)
  createdAt DateTime @default(now())

  @@index([bookingId])
  @@index([token])
}

model security_audit_logs {
  id        String                 @id
  eventType SecurityAuditEventType
  userId    String?
  userEmail String?
  userRole  String?
  ipAddress String
  userAgent String
  severity  SecurityAuditSeverity
  pathname  String?
  query     Json?
  referrer  String?
  details   Json
  timestamp DateTime               @default(now())
  users     users?                 @relation(fields: [userId], references: [id])

  @@index([eventType, timestamp])
  @@index([ipAddress, timestamp])
  @@index([severity, timestamp])
  @@index([timestamp])
  @@index([userId, timestamp])
}

model seminar_registrations {
  id                String               @id
  parentName        String
  email             String
  whatsappNumber    String
  city              String
  studentClass      String?
  referralCode      String?
  razorpayOrderId   String               @unique
  razorpayPaymentId String?              @unique
  paymentStatus     SeminarPaymentStatus @default(PENDING)
  amount            Int                  @default(19900)
  pricingTier       SeminarPricingTier   @default(STANDARD)
  seminarDate       DateTime
  seminarSlot       String
  attended          Boolean              @default(false)
  joinedAt          DateTime?
  whatsappOptIn     Boolean              @default(true)
  emailOptIn        Boolean              @default(true)
  dripStage         Int                  @default(0)
  lastDripSentAt    DateTime?
  demoClassBooked   Boolean              @default(false)
  demoBookedAt      DateTime?
  courseEnrolled    Boolean              @default(false)
  enrolledAt        DateTime?
  courseId          String?
  utmSource         String?
  utmMedium         String?
  utmCampaign       String?
  ipAddress         String?
  userAgent         String?
  createdAt         DateTime             @default(now())
  updatedAt         DateTime

  @@index([dripStage, lastDripSentAt])
  @@index([email])
  @@index([paymentStatus, createdAt])
  @@index([referralCode])
  @@index([seminarDate])
  @@index([whatsappNumber])
}

model seo_content_sources {
  id            String    @id
  sourceType    String
  sourceName    String
  sourceUrl     String?
  lastCheckedAt DateTime?
  lastContentAt DateTime?
  isActive      Boolean   @default(true)
  feedUrl       String?
  feedFormat    String?
  trendKeywords String[]
  trendScore    Float?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime

  @@index([lastCheckedAt])
  @@index([sourceType, isActive])
}

model sessions {
  id               String   @id
  sessionToken     String   @unique
  userId           String
  expires          DateTime
  // Refresh token rotation: stores hash of current valid refresh token
  // When a refresh occurs, this is updated. If an old token is used, session is invalidated.
  refreshTokenHash String?
  // Track token version for easier rotation management
  tokenVersion     Int      @default(1)
  createdAt        DateTime @default(now())
  lastRefreshedAt  DateTime @default(now())
  users            users    @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([userId])
  @@index([expires])
}

model student_attendance {
  id                                        String           @id
  sessionId                                 String
  studentId                                 String
  enrollmentId                              String?
  status                                    AttendanceStatus @default(ABSENT)
  markedAt                                  DateTime         @default(now())
  markedBy                                  String
  checkInTime                               DateTime?
  checkOutTime                              DateTime?
  duration                                  Int?
  isLate                                    Boolean          @default(false)
  lateBy                                    Int?
  notes                                     String?
  isExcused                                 Boolean          @default(false)
  participationScore                        Int?
  deviceInfo                                String?
  ipAddress                                 String?
  location                                  String?
  metadata                                  Json?
  createdAt                                 DateTime         @default(now())
  updatedAt                                 DateTime
  enrollments                               enrollments?     @relation(fields: [enrollmentId], references: [id])
  users_student_attendance_markedByTousers  users            @relation("student_attendance_markedByTousers", fields: [markedBy], references: [id])
  class_sessions                            class_sessions   @relation(fields: [sessionId], references: [id], onDelete: Cascade)
  users_student_attendance_studentIdTousers users            @relation("student_attendance_studentIdTousers", fields: [studentId], references: [id], onDelete: Cascade)

  @@unique([sessionId, studentId])
  @@index([enrollmentId, status])
  @@index([markedAt])
  @@index([sessionId, status])
  @@index([status, markedAt])
  @@index([studentId, status])
}

model study_materials {
  id                String              @id
  title             String
  description       String?
  materialType      MaterialType
  fileUrl           String
  fileName          String
  fileSize          Int
  mimeType          String              @default("application/pdf")
  courseId          String?
  chapterId         String?
  topicId           String?
  tags              Json?
  accessLevel       AccessLevel         @default(ENROLLED)
  requiredCourseId  String?
  sortOrder         Int                 @default(0)
  category          String?
  uploadedBy        String
  isPublished       Boolean             @default(false)
  publishedAt       DateTime?
  totalDownloads    Int                 @default(0)
  totalViews        Int                 @default(0)
  avgRating         Float               @default(0)
  ratingCount       Int                 @default(0)
  createdAt         DateTime            @default(now())
  updatedAt         DateTime
  material_access   material_access[]
  material_progress material_progress[]
  chapters          chapters?           @relation(fields: [chapterId], references: [id])
  courses           courses?            @relation(fields: [courseId], references: [id])
  topics            topics?             @relation(fields: [topicId], references: [id])
  video_lectures    video_lectures?

  @@index([courseId, isPublished])
  @@index([createdAt])
  @@index([materialType, accessLevel])
}

model study_plans {
  id              String     @id
  freeUserId      String
  title           String
  targetExam      String
  examDate        DateTime?
  schedule        Json
  currentWeek     Int        @default(1)
  totalWeeks      Int
  completedTopics Json?
  currentTopic    String?
  overallProgress Int        @default(0)
  isActive        Boolean    @default(true)
  createdAt       DateTime   @default(now())
  updatedAt       DateTime
  free_users      free_users @relation(fields: [freeUserId], references: [id], onDelete: Cascade)
}

model tasks {
  id                              String       @id
  leadId                          String?
  title                           String
  description                     String?
  type                            TaskType
  priority                        TaskPriority @default(MEDIUM)
  dueDate                         DateTime
  dueTime                         String?
  status                          TaskStatus   @default(PENDING)
  completedAt                     DateTime?
  assignedToId                    String
  createdById                     String?
  isAutoGenerated                 Boolean      @default(false)
  triggerEvent                    String?
  snoozedUntil                    DateTime?
  createdAt                       DateTime     @default(now())
  updatedAt                       DateTime
  users_tasks_assignedToIdTousers users        @relation("tasks_assignedToIdTousers", fields: [assignedToId], references: [id])
  users_tasks_createdByIdTousers  users?       @relation("tasks_createdByIdTousers", fields: [createdById], references: [id])
  leads                           leads?       @relation(fields: [leadId], references: [id], onDelete: Cascade)

  @@index([assignedToId, status, dueDate])
  @@index([dueDate, status])
  @@index([leadId])
}

model test_analytics {
  id                   String        @id
  testSessionId        String        @unique
  totalTime            Int
  averageTimePerQ      Float
  questionsAttempted   Int
  questionsCorrect     Int
  accuracy             Float
  questionsSkipped     Int           @default(0)
  questionsRevisited   Int           @default(0)
  timeDistribution     Json
  answerPattern        Json
  easyQuestions        Json
  mediumQuestions      Json
  hardQuestions        Json
  topicPerformance     Json
  strengthTopics       Json
  weaknessTopics       Json
  percentileRank       Float?
  averageComparison    Float?
  predictedScore       Float?
  recommendedStudyTime Int?
  analyzedAt           DateTime      @default(now())
  test_sessions        test_sessions @relation(fields: [testSessionId], references: [id], onDelete: Cascade)
}

model test_assignment_questions {
  id               String           @id
  testAssignmentId String
  questionId       String
  orderIndex       Int
  marks            Int              @default(4)
  negativeMarks    Decimal?         @db.Decimal(3, 2)
  questions        questions        @relation(fields: [questionId], references: [id], onDelete: Cascade)
  test_assignments test_assignments @relation(fields: [testAssignmentId], references: [id], onDelete: Cascade)

  @@unique([testAssignmentId, questionId])
  @@index([testAssignmentId, orderIndex])
}

model test_assignment_submissions {
  id                 String               @id
  testAssignmentId   String
  studentId          String
  status             SubmissionTestStatus @default(NOT_STARTED)
  startedAt          DateTime?
  submittedAt        DateTime?
  timeSpent          Int                  @default(0)
  remainingTime      Int?
  tabSwitchCount     Int                  @default(0)
  fullscreenExits    Int                  @default(0)
  browserInfo        Json?
  totalScore         Int?
  percentage         Decimal?             @db.Decimal(5, 2)
  questionsAttempted Int                  @default(0)
  questionsCorrect   Int                  @default(0)
  questionsWrong     Int                  @default(0)
  questionsSkipped   Int                  @default(0)
  isGraded           Boolean              @default(false)
  gradedAt           DateTime?
  gradedBy           String?
  teacherFeedback    String?
  answers            Json?
  metadata           Json?
  createdAt          DateTime             @default(now())
  updatedAt          DateTime
  users              users                @relation(fields: [studentId], references: [id], onDelete: Cascade)
  test_assignments   test_assignments     @relation(fields: [testAssignmentId], references: [id], onDelete: Cascade)

  @@unique([testAssignmentId, studentId])
  @@index([studentId, status])
  @@index([submittedAt])
  @@index([testAssignmentId, status])
}

model test_assignments {
  id                          String                        @id
  teacherId                   String
  testTemplateId              String?
  title                       String
  description                 String?
  instructions                String?
  difficulty                  DifficultyLevel               @default(MEDIUM)
  totalQuestions              Int
  totalMarks                  Int
  duration                    Int
  negativeMarking             Boolean                       @default(false)
  negativeMarkValue           Decimal?                      @db.Decimal(3, 2)
  shuffleQuestions            Boolean                       @default(false)
  showResults                 ShowResultsType               @default(IMMEDIATELY)
  passingMarks                Int?
  assignToType                AssignToType                  @default(ALL_STUDENTS)
  assignedClassIds            String[]
  assignedBatchIds            String[]
  assignedStudentIds          String[]
  courseId                    String?
  dueDate                     DateTime
  availableFrom               DateTime?
  status                      TestAssignmentStatus          @default(DRAFT)
  publishedAt                 DateTime?
  selectedChapters            String[]
  selectedTopics              String[]
  questionSource              QuestionSourceType            @default(QUESTION_BANK)
  useAI                       Boolean                       @default(false)
  totalAssigned               Int                           @default(0)
  totalSubmitted              Int                           @default(0)
  totalGraded                 Int                           @default(0)
  averageScore                Decimal?                      @db.Decimal(5, 2)
  metadata                    Json?
  createdAt                   DateTime                      @default(now())
  updatedAt                   DateTime
  test_assignment_questions   test_assignment_questions[]
  test_assignment_submissions test_assignment_submissions[]
  users                       users                         @relation(fields: [teacherId], references: [id], onDelete: Cascade)
  test_templates              test_templates?               @relation(fields: [testTemplateId], references: [id])

  @@index([courseId])
  @@index([dueDate])
  @@index([status, dueDate])
  @@index([teacherId, status])
}

model test_attempts {
  id               String           @id
  freeUserId       String
  title            String
  topics           Json?
  questionCount    Int
  timeLimit        Int?
  score            Int
  totalMarks       Int
  percentage       Float
  timeSpent        Int
  topicWiseScore   Json
  strengthAreas    Json?
  weaknessAreas    Json?
  recommendations  Json?
  status           TestStatus       @default(IN_PROGRESS)
  startedAt        DateTime         @default(now())
  submittedAt      DateTime?
  accuracy         Float?
  consistency      Float?
  improvementAreas Json?
  rank             Int?
  speed            Float?
  testTemplateId   String?
  difficulty       DifficultyLevel  @default(MEDIUM)
  free_users       free_users       @relation(fields: [freeUserId], references: [id], onDelete: Cascade)
  test_templates   test_templates?  @relation(fields: [testTemplateId], references: [id])
  test_questions   test_questions[]

  @@index([freeUserId, startedAt])
  @@index([percentage])
  @@index([testTemplateId])
}

model test_questions {
  id                String        @id
  testAttemptId     String
  questionId        String
  selectedAnswer    String?
  isCorrect         Boolean?
  timeSpent         Int?
  marksAwarded      Int           @default(0)
  attempts          Int           @default(1)
  confidenceLevel   Int?
  isMarkedForReview Boolean       @default(false)
  questions         questions     @relation(fields: [questionId], references: [id])
  test_attempts     test_attempts @relation(fields: [testAttemptId], references: [id], onDelete: Cascade)

  @@unique([testAttemptId, questionId])
}

model test_schedules {
  id        String         @id
  classType BatchClassType @unique
  day       String
  time      String
  mode      String
  isActive  Boolean        @default(true)
  createdAt DateTime       @default(now())
  updatedAt DateTime
}

model test_sessions {
  id                       String                    @id
  userId                   String?
  freeUserId               String?
  testTemplateId           String
  sessionToken             String                    @unique
  status                   TestSessionStatus         @default(NOT_STARTED)
  startedAt                DateTime?
  pausedAt                 DateTime?
  resumedAt                DateTime?
  submittedAt              DateTime?
  timeSpent                Int                       @default(0)
  remainingTime            Int?
  currentQuestionIndex     Int                       @default(0)
  questionsAnswered        Int                       @default(0)
  questionsMarkedForReview Int                       @default(0)
  browserInfo              Json?
  ipAddress                String?
  locationData             Json?
  tabSwitchCount           Int                       @default(0)
  fullscreenExits          Int                       @default(0)
  suspiciousActivity       Json?
  isProctored              Boolean                   @default(false)
  totalScore               Int?
  percentage               Float?
  rank                     Int?
  createdAt                DateTime                  @default(now())
  updatedAt                DateTime
  test_analytics           test_analytics?
  free_users               free_users?               @relation(fields: [freeUserId], references: [id])
  test_templates           test_templates            @relation(fields: [testTemplateId], references: [id])
  users                    users?                    @relation(fields: [userId], references: [id])
  user_question_responses  user_question_responses[]

  @@index([freeUserId, status])
  @@index([sessionToken])
  @@index([testTemplateId, submittedAt])
  @@index([userId, status])
}

model test_templates {
  id                      String                    @id
  title                   String
  description             String?
  slug                    String                    @unique
  type                    TestType                  @default(PRACTICE_TEST)
  category                TestCategory              @default(TOPIC_WISE)
  difficulty              DifficultyLevel           @default(MEDIUM)
  timeLimit               Int
  totalQuestions          Int
  totalMarks              Int
  passingMarks            Int?
  curriculum              String
  grade                   String
  subject                 String                    @default("biology")
  topics                  Json
  negativeMarking         Boolean                   @default(false)
  markingScheme           Json?
  questionDistribution    Json?
  instructions            Json?
  isAdaptive              Boolean                   @default(false)
  adaptiveSettings        Json?
  attemptCount            Int                       @default(0)
  averageScore            Float?
  averageTime             Int?
  popularityScore         Float                     @default(0)
  isActive                Boolean                   @default(true)
  isPremium               Boolean                   @default(false)
  isPublished             Boolean                   @default(false)
  publishedAt             DateTime?
  seoTitle                String?
  seoDescription          String?
  seoKeywords             Json?
  createdAt               DateTime                  @default(now())
  updatedAt               DateTime
  createdBy               String?
  question_bank_questions question_bank_questions[]
  test_assignments        test_assignments[]
  test_attempts           test_attempts[]
  test_sessions           test_sessions[]

  @@index([curriculum, grade])
  @@index([isActive, isPublished])
  @@index([popularityScore])
  @@index([type, category])
}

model topics {
  id              String            @id
  chapterId       String
  title           String
  description     String?
  orderIndex      Int
  isActive        Boolean           @default(true)
  createdAt       DateTime          @default(now())
  updatedAt       DateTime
  assignments     assignments[]
  doubt_tickets   doubt_tickets[]
  study_materials study_materials[]
  chapters        chapters          @relation(fields: [chapterId], references: [id], onDelete: Cascade)
  video_chapters  video_chapters[]

  @@index([chapterId, orderIndex])
}

model user_device_limits {
  id               String    @id
  userId           String    @unique
  maxDevices       Int       @default(2)
  activeDevices    Int       @default(0)
  violationCount   Int       @default(0)
  lastViolationAt  DateTime?
  isRestricted     Boolean   @default(false)
  restrictedUntil  DateTime?
  restrictedReason String?
  createdAt        DateTime  @default(now())
  updatedAt        DateTime
  users            users     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([isRestricted])
}

model user_progress {
  id              String          @id
  userId          String?
  freeUserId      String?
  topic           String
  subtopic        String?
  curriculum      String
  grade           String
  totalQuestions  Int             @default(0)
  correctAnswers  Int             @default(0)
  accuracy        Float           @default(0)
  averageTime     Int?
  improvementRate Float           @default(0)
  currentLevel    DifficultyLevel @default(EASY)
  masteryScore    Float           @default(0)
  recommendedNext Json?
  weakAreas       Json?
  strongAreas     Json?
  lastPracticed   DateTime?
  createdAt       DateTime        @default(now())
  updatedAt       DateTime
  free_users      free_users?     @relation(fields: [freeUserId], references: [id])
  users           users?          @relation(fields: [userId], references: [id])

  @@unique([freeUserId, topic, curriculum, grade])
  @@unique([userId, topic, curriculum, grade])
  @@index([topic, masteryScore])
}

model user_question_responses {
  id             String         @id
  userId         String?
  freeUserId     String?
  questionId     String
  testSessionId  String?
  selectedAnswer String?
  isCorrect      Boolean?
  timeSpent      Int?
  marksAwarded   Int            @default(0)
  confidence     Int?
  responseMode   ResponseMode   @default(TEST_MODE)
  deviceType     String?
  answeredAt     DateTime       @default(now())
  free_users     free_users?    @relation(fields: [freeUserId], references: [id])
  questions      questions      @relation(fields: [questionId], references: [id])
  test_sessions  test_sessions? @relation(fields: [testSessionId], references: [id])
  users          users?         @relation(fields: [userId], references: [id])

  @@index([freeUserId, answeredAt])
  @@index([questionId, isCorrect])
  @@index([userId, answeredAt])
}

model users {
  id                                                                    String                        @id
  email                                                                 String                        @unique
  phone                                                                 String?                       @unique
  name                                                                  String
  role                                                                  UserRole                      @default(STUDENT)
  passwordHash                                                          String?
  emailVerified                                                         DateTime?
  phoneVerified                                                         DateTime?
  profile                                                               Json?
  createdAt                                                             DateTime                      @default(now())
  updatedAt                                                             DateTime
  lastActiveAt                                                          DateTime?
  verificationToken                                                     String?
  verificationTokenExpiry                                               DateTime?
  firebaseUid                                                           String?                       @unique
  coachingTier                                                          CoachingTier?                 @default(FREE)
  trialStartDate                                                        DateTime?
  trialEndDate                                                          DateTime?
  activities                                                            activities[]
  assignment_submissions                                                assignment_submissions[]
  assignments                                                           assignments[]
  certificates                                                          certificates[]
  class_sessions                                                        class_sessions[]
  communication_logs                                                    communication_logs[]
  contact_inquiries                                                     contact_inquiries[]
  counselor_goals                                                       counselor_goals[]
  counselor_kpis                                                        counselor_kpis[]
  counselor_leaderboard                                                 counselor_leaderboard[]
  crm_communications                                                    crm_communications[]
  demo_bookings                                                         demo_bookings[]
  doubt_messages                                                        doubt_messages[]
  doubt_tickets_doubt_tickets_instructorIdTousers                       doubt_tickets[]               @relation("doubt_tickets_instructorIdTousers")
  doubt_tickets_doubt_tickets_studentIdTousers                          doubt_tickets[]               @relation("doubt_tickets_studentIdTousers")
  enrollments                                                           enrollments[]
  error_reports                                                         error_reports[]
  fee_plans                                                             fee_plans[]
  followup_history                                                      followup_history[]
  followup_rules_followup_rules_createdByIdTousers                      followup_rules[]              @relation("followup_rules_createdByIdTousers")
  followup_rules_followup_rules_updatedByIdTousers                      followup_rules[]              @relation("followup_rules_updatedByIdTousers")
  followup_templates                                                    followup_templates[]
  gallery_items                                                         gallery_items[]
  leads                                                                 leads[]
  lms_device_sessions                                                   lms_device_sessions[]
  lms_progress_notifications                                            lms_progress_notifications[]
  lms_security_events                                                   lms_security_events[]
  lms_whatsapp_sessions                                                 lms_whatsapp_sessions?
  material_access                                                       material_access[]
  material_progress                                                     material_progress[]
  message_templates                                                     message_templates[]
  notes                                                                 notes[]
  offers                                                                offers[]
  parent_child_relationships_parent_child_relationships_childIdTousers  parent_child_relationships[]  @relation("parent_child_relationships_childIdTousers")
  parent_child_relationships_parent_child_relationships_parentIdTousers parent_child_relationships[]  @relation("parent_child_relationships_parentIdTousers")
  payments                                                              payments[]
  performance_reports                                                   performance_reports[]
  product_recommendations                                               product_recommendations[]
  security_audit_logs                                                   security_audit_logs[]
  sessions                                                              sessions[]
  student_attendance_student_attendance_markedByTousers                 student_attendance[]          @relation("student_attendance_markedByTousers")
  student_attendance_student_attendance_studentIdTousers                student_attendance[]          @relation("student_attendance_studentIdTousers")
  tasks_tasks_assignedToIdTousers                                       tasks[]                       @relation("tasks_assignedToIdTousers")
  tasks_tasks_createdByIdTousers                                        tasks[]                       @relation("tasks_createdByIdTousers")
  test_assignment_submissions                                           test_assignment_submissions[]
  test_assignments                                                      test_assignments[]
  test_sessions                                                         test_sessions[]
  user_device_limits                                                    user_device_limits?
  user_progress                                                         user_progress[]
  user_question_responses                                               user_question_responses[]
  video_notes                                                           video_notes[]
  video_progress                                                        video_progress[]
  whatsapp_conversations                                                whatsapp_conversations[]
  whatsapp_messages                                                     whatsapp_messages[]
  webhooks                                                              webhooks[]
  coupon_redemptions                                                    coupon_redemptions[]
  email_verification_tokens                                             email_verification_tokens[]
  password_reset_tokens                                                 password_reset_tokens[]

  @@index([coachingTier])
  @@index([emailVerified])
  @@index([firebaseUid])
  @@index([lastActiveAt])
  @@index([role, createdAt])
  @@index([trialEndDate])
}

model video_chapters {
  id             String         @id
  videoLectureId String
  title          String
  description    String?
  startTime      Int
  endTime        Int?
  orderIndex     Int
  thumbnailUrl   String?
  topicId        String?
  createdAt      DateTime       @default(now())
  updatedAt      DateTime
  topics         topics?        @relation(fields: [topicId], references: [id])
  video_lectures video_lectures @relation(fields: [videoLectureId], references: [id], onDelete: Cascade)

  @@index([topicId])
  @@index([videoLectureId, orderIndex])
}

model video_lectures {
  id                  String                @id
  studyMaterialId     String                @unique
  cloudflareVideoId   String                @unique
  cloudflareStreamUrl String?
  cloudflareThumbUrl  String?
  playbackPolicy      PlaybackPolicy        @default(SIGNED_URL)
  title               String
  description         String?
  duration            Int
  resolution          String?
  fileSize            BigInt?
  hasPdfSync          Boolean               @default(false)
  syncPdfUrl          String?
  syncPdfPageCount    Int?
  uploadStatus        VideoUploadStatus     @default(PROCESSING)
  processingProgress  Int                   @default(0)
  processedAt         DateTime?
  totalViews          Int                   @default(0)
  totalWatchTime      Int                   @default(0)
  avgCompletionRate   Decimal               @default(0) @db.Decimal(5, 2)
  avgRating           Decimal               @default(0) @db.Decimal(3, 2)
  ratingCount         Int                   @default(0)
  previewSeconds      Int                   @default(30)
  requiresEnrollment  Boolean               @default(true)
  metadata            Json?
  createdAt           DateTime              @default(now())
  updatedAt           DateTime
  lms_security_events lms_security_events[]
  pdf_sync_data       pdf_sync_data[]
  video_chapters      video_chapters[]
  study_materials     study_materials       @relation(fields: [studyMaterialId], references: [id], onDelete: Cascade)
  video_notes         video_notes[]
  video_progress      video_progress[]

  @@index([avgRating])
  @@index([cloudflareVideoId])
  @@index([totalViews])
  @@index([uploadStatus])
}

model video_notes {
  id             String         @id
  videoLectureId String
  userId         String
  timestamp      Int
  content        String
  aiSummary      String?
  isHighlighted  Boolean        @default(false)
  color          String?
  tags           String[]
  createdAt      DateTime       @default(now())
  updatedAt      DateTime
  users          users          @relation(fields: [userId], references: [id], onDelete: Cascade)
  video_lectures video_lectures @relation(fields: [videoLectureId], references: [id], onDelete: Cascade)

  @@index([userId, createdAt])
  @@index([videoLectureId, userId, timestamp])
}

model video_progress {
  id                 String         @id
  videoLectureId     String
  userId             String
  enrollmentId       String?
  watchedSeconds     Int            @default(0)
  lastPosition       Int            @default(0)
  completionPercent  Decimal        @default(0) @db.Decimal(5, 2)
  isCompleted        Boolean        @default(false)
  completedAt        DateTime?
  totalWatchSessions Int            @default(0)
  lastWatchedAt      DateTime?
  firstWatchedAt     DateTime?
  pauseCount         Int            @default(0)
  seekCount          Int            @default(0)
  replayCount        Int            @default(0)
  playbackSpeed      Decimal        @default(1.0) @db.Decimal(3, 2)
  preferredQuality   String?
  rating             Int?
  ratedAt            DateTime?
  lastDeviceId       String?
  lastDeviceType     String?
  metadata           Json?
  createdAt          DateTime       @default(now())
  updatedAt          DateTime
  enrollments        enrollments?   @relation(fields: [enrollmentId], references: [id])
  users              users          @relation(fields: [userId], references: [id], onDelete: Cascade)
  video_lectures     video_lectures @relation(fields: [videoLectureId], references: [id], onDelete: Cascade)

  @@unique([videoLectureId, userId])
  @@index([completionPercent])
  @@index([isCompleted])
  @@index([userId, lastWatchedAt])
}

model whatsapp_conversations {
  id                  String              @id
  phone               String
  leadId              String?
  assignedCounselorId String?
  lastMessageAt       DateTime            @default(now())
  status              ConversationStatus  @default(ACTIVE)
  createdAt           DateTime            @default(now())
  updatedAt           DateTime
  users               users?              @relation(fields: [assignedCounselorId], references: [id])
  leads               leads?              @relation(fields: [leadId], references: [id])
  whatsapp_messages   whatsapp_messages[]

  @@index([assignedCounselorId])
  @@index([leadId])
  @@index([phone])
  @@index([status, lastMessageAt])
}

model whatsapp_messages {
  id                     String                 @id
  conversationId         String
  messageId              String?                @unique
  phone                  String
  direction              MessageDirection
  content                String
  messageType            String                 @default("text")
  mediaUrl               String?
  status                 MessageStatus          @default(SENT)
  sentBy                 String?
  timestamp              DateTime               @default(now())
  createdAt              DateTime               @default(now())
  whatsapp_conversations whatsapp_conversations @relation(fields: [conversationId], references: [id], onDelete: Cascade)
  users                  users?                 @relation(fields: [sentBy], references: [id])

  @@index([conversationId, timestamp])
  @@index([messageId])
  @@index([phone])
}

model whatsapp_otp {
  id        String   @id
  phone     String
  otp       String
  expiresAt DateTime
  verified  Boolean  @default(false)
  attempts  Int      @default(0)
  createdAt DateTime @default(now())

  @@index([phone, expiresAt])
  @@index([phone, verified])
}

model webhooks {
  id                 String               @id
  name               String
  url                String
  events             String[]
  secret             String?
  headers            Json?
  retryPolicy        Json?
  isActive           Boolean              @default(true)
  metadata           Json?
  createdById        String?
  createdAt          DateTime             @default(now())
  updatedAt          DateTime
  users              users?               @relation(fields: [createdById], references: [id])
  webhook_deliveries webhook_deliveries[]

  @@index([isActive])
  @@index([createdById])
}

model webhook_deliveries {
  id           String                @id
  webhookId    String
  event        String
  payload      Json
  status       WebhookDeliveryStatus @default(PENDING)
  statusCode   Int?
  responseBody String?
  errorMessage String?
  attempts     Int                   @default(0)
  completedAt  DateTime?
  createdAt    DateTime              @default(now())
  webhooks     webhooks              @relation(fields: [webhookId], references: [id], onDelete: Cascade)

  @@index([webhookId, createdAt])
  @@index([status])
  @@index([event, createdAt])
}

enum WebhookDeliveryStatus {
  PENDING
  SUCCESS
  FAILED
  RETRYING
}

enum AccessLevel {
  FREE
  ENROLLED
  PREMIUM
  SPECIFIC_COURSE
}

enum AchievementType {
  FIRST_TEST
  STREAK_7_DAYS
  STREAK_30_DAYS
  TOPIC_MASTER
  SPEED_DEMON
  PERFECTIONIST
  COMMUNITY_HELPER
  BOOKWORM
}

enum AgentTaskStatus {
  PENDING
  SCHEDULED
  RUNNING
  COMPLETED
  FAILED
  CANCELLED
}

enum AgentType {
  LEAD_QUALIFIER
  NURTURE
  CALL_PREP
  CONTENT_GENERATOR
  CALL_TRANSCRIPTION
  CALL_SUMMARY
  ACTION_EXTRACTOR
  PRODUCT_AGENT
}

enum AssignToType {
  ALL_STUDENTS
  SPECIFIC_CLASS
  SPECIFIC_BATCH
  INDIVIDUAL_STUDENTS
}

enum AssignmentStatus {
  DRAFT
  PUBLISHED
  CLOSED
}

enum AttendanceStatus {
  PRESENT
  ABSENT
  LATE
  EXCUSED
  HALF_DAY
}

enum BadgeCategory {
  STREAK
  MILESTONE
  ACCURACY
  CONTRIBUTOR
  SPECIAL
  TOPIC_MASTER
}

enum BadgeRarity {
  COMMON
  UNCOMMON
  RARE
  EPIC
  LEGENDARY
}

enum BatchClassType {
  CLASS_11
  CLASS_12
  DROPPERS
}

enum BatchLocation {
  GURUGRAM
  SOUTH_EXT
  ROHINI
}

enum BatchStatus {
  AVAILABLE
  FULL
}

enum CertificateStatus {
  DRAFT
  ISSUED
  REVOKED
  EXPIRED
}

enum CertificateType {
  COURSE_COMPLETION
  EXCELLENCE
  PARTICIPATION
  ACHIEVEMENT
  APPRECIATION
  SPECIAL_RECOGNITION
}

enum CoachingTier {
  FREE
  PURSUIT
  ASCENT
  PINNACLE
}

enum CommStatus {
  PENDING
  SENT
  DELIVERED
  READ
  FAILED
}

enum CommType {
  WHATSAPP
  EMAIL
  CALL
  SMS
}

enum CommunicationChannel {
  WHATSAPP
  EMAIL
  SMS
  PHONE_CALL
  IN_APP_NOTIFICATION
}

enum CommunicationType {
  WELCOME_MESSAGE
  DEMO_CONFIRMATION
  DEMO_REMINDER
  ENROLLMENT_CONFIRMATION
  PAYMENT_REMINDER
  COURSE_UPDATE
  MARKETING_MESSAGE
  SUPPORT_MESSAGE
  FEEDBACK_REQUEST
  CUSTOM_MESSAGE
}

enum CommunityQuestionStatus {
  PENDING
  AI_SCREENING
  AI_APPROVED
  AI_REJECTED
  ADMIN_REVIEW
  APPROVED
  REJECTED
  DISPUTED
}

enum ContentGenerationStatus {
  PENDING
  GENERATING
  REVIEW
  APPROVED
  REJECTED
  ITERATING
  PUBLISHED
  FAILED
}

enum ContentGenerationType {
  BLOG_POST
  NEWS_ARTICLE
  SEO_LANDING_PAGE
  SOCIAL_POST
  LEAD_MAGNET
}

enum ContentPriority {
  URGENT
  HIGH
  NORMAL
  LOW
}

enum ContentTriggerSource {
  SCHEDULED
  NEWS_FEED
  TREND_DETECTED
  KEYWORD_FORECAST
  MANUAL
}

enum ConversationStatus {
  ACTIVE
  ARCHIVED
  CLOSED
}

enum CounselorGoalType {
  LEADS_CREATED
  CONVERSIONS
  REVENUE
  DEMOS_SCHEDULED
  FOLLOW_UPS
  RESPONSE_TIME
  CUSTOM
}

enum CourseType {
  NEET_COMPLETE
  CLASS_11
  CLASS_12
  DROPPER
  FOUNDATION
  CRASH_COURSE
}

enum DemoBookingStatus {
  PENDING
  CONFIRMED
  COMPLETED
  CANCELLED
  NO_SHOW
  RESCHEDULED
}

enum DemoPaymentStatus {
  NOT_REQUIRED
  PENDING
  COMPLETED
  FAILED
  REFUNDED
}

enum DemoType {
  FREE
  PREMIUM
}

enum DesignType {
  MODERN
  CLASSIC
  PREMIUM
  MINIMALIST
  ELEGANT
}

enum DeviceType {
  DESKTOP
  MOBILE
  TABLET
  TV
  UNKNOWN
}

enum DiagramCategory {
  CELL_BIOLOGY
  MOLECULAR_BIOLOGY
  GENETICS
  HUMAN_PHYSIOLOGY
  PLANT_PHYSIOLOGY
  REPRODUCTION
  ECOLOGY
  EVOLUTION
  BIOTECHNOLOGY
  MICROORGANISMS
  ANIMAL_KINGDOM
  PLANT_KINGDOM
}

enum DiagramSource {
  WIKIMEDIA
  BIOICONS
  SERVIER
  PHYLOPIC
  AI_GENERATED
  BIORENDER
  CUSTOM_UPLOAD
  NCERT_REFERENCE
}

enum DifficultyLevel {
  EASY
  MEDIUM
  HARD
  EXPERT
}

enum Direction {
  INBOUND
  OUTBOUND
}

enum DiscountType {
  PERCENTAGE
  FIXED_AMOUNT
}

enum DoubtPriority {
  LOW
  MEDIUM
  HIGH
  URGENT
}

enum DoubtStatus {
  OPEN
  IN_PROGRESS
  ANSWERED
  RESOLVED
  CLOSED
}

enum EnrollmentStatus {
  PENDING
  ACTIVE
  COMPLETED
  CANCELLED
  SUSPENDED
}

enum ErrorReportSeverity {
  low
  normal
  high
  critical
}

enum ErrorReportStatus {
  PENDING
  UNDER_REVIEW
  ACCEPTED
  REJECTED
  DUPLICATE
}

enum ErrorReportType {
  WRONG_ANSWER
  AMBIGUOUS
  OUTDATED
  TYPO
  INCOMPLETE
  OTHER
}

enum FeeStatus {
  PENDING
  PARTIAL
  COMPLETED
  CANCELLED
}

enum FollowupAction {
  EMAIL
  WHATSAPP
  CALL_TASK
  SMS
  NOTIFICATION
  TASK
}

enum FollowupTrigger {
  STAGE_CHANGE
  TIME_BASED
  SCORE_THRESHOLD
  INACTIVITY
  DEMO_NO_SHOW
  DEMO_COMPLETED
  OFFER_SENT
  CUSTOM
}

enum FreeResourceClass {
  CLASS_9
  CLASS_10
  CLASS_11
  CLASS_12
  DROPPERS
  ALL
}

enum FreeResourceType {
  PDF
  TIMETABLE
  ANNOUNCEMENT
  NOTES
  FORMULA_SHEET
}

enum GalleryCategory {
  TOPPERS
  EVENTS
  SEMINARS
  FACULTY
  CAMPUS
  MEDIA
  VIDEOS
}

enum GalleryItemType {
  PHOTO
  VIDEO
}

enum GoalPeriod {
  DAILY
  WEEKLY
  MONTHLY
  QUARTERLY
  YEARLY
}

enum GoalStatus {
  ACTIVE
  ACHIEVED
  MISSED
  CANCELLED
}

enum InquiryPriority {
  LOW
  NORMAL
  MEDIUM
  HIGH
  URGENT
}

enum InquiryStatus {
  NEW
  IN_PROGRESS
  RESPONDED
  RESOLVED
  CLOSED
  SPAM
}

enum LeadSource {
  MANUAL_ENTRY
  WALK_IN
  PHONE_CALL
  REFERRAL
  WHATSAPP
  EMAIL
  SOCIAL_MEDIA
  WEBSITE
  ADVERTISEMENT
  EVENT
  OTHER
}

enum LeadStage {
  NEW_LEAD
  DEMO_SCHEDULED
  DEMO_COMPLETED
  OFFER_SENT
  NEGOTIATING
  PAYMENT_PLAN_CREATED
  ENROLLED
  ACTIVE_STUDENT
  LOST
}

enum LeaderboardPeriod {
  DAILY
  WEEKLY
  MONTHLY
  ALL_TIME
}

enum LmsNotificationType {
  NEW_VIDEO_ADDED
  COURSE_REMINDER
  PROGRESS_MILESTONE
  CHAPTER_COMPLETED
  COURSE_COMPLETED
  CERTIFICATE_READY
  LIVE_CLASS_REMINDER
  ASSIGNMENT_DUE
  NEW_ANNOUNCEMENT
}

enum LmsSecurityEvent {
  DEVICE_LIMIT_EXCEEDED
  SCREEN_RECORDING_DETECTED
  SCREENSHOT_DETECTED
  SUSPICIOUS_ACTIVITY
  VPN_DETECTED
  CONCURRENT_STREAM
  DOWNLOAD_ATTEMPT
  WATERMARK_TAMPER
  GEO_RESTRICTION
  TOKEN_SHARING
  ACCOUNT_SHARING
}

enum LmsWhatsAppState {
  MAIN_MENU
  MY_COURSES
  COURSE_DETAIL
  CHAPTER_LIST
  VIDEO_LIST
  VIDEO_DETAIL
  MY_PROGRESS
  CONTINUE_WATCHING
  SEARCH
  HELP
  SETTINGS
  NOTIFICATIONS
}

enum MaterialType {
  PDF_NOTES
  PDF_ASSIGNMENT
  PDF_PRACTICE_PAPER
  PDF_REFERENCE
  PDF_EBOOK
  VIDEO
  LINK
}

enum MessageDirection {
  INBOUND
  OUTBOUND
}

enum MessageStatus {
  SENT
  DELIVERED
  READ
  FAILED
  PENDING
}

enum MessageType {
  TEXT
  IMAGE
  FILE
  VOICE
  VIDEO
}

enum NotificationStatus {
  DRAFT
  SCHEDULED
  SENDING
  SENT
  FAILED
  CANCELLED
}

enum NotificationType {
  NEW_MATERIAL
  ASSIGNMENT_REMINDER
  COURSE_UPDATE
  ANNOUNCEMENT
  CUSTOM
}

enum OMRAnswerKeyStatus {
  UNVERIFIED
  VERIFIED
  DISPUTED
}

enum OMRPaperStatus {
  DRAFT
  ACTIVE
  CLOSED
  ARCHIVED
}

enum OMRSubjectType {
  BIOLOGY_XI
  BIOLOGY_XII
  BIOLOGY_XI_XII
  NEET_MOCK
}

enum OfferStatus {
  DRAFT
  SENT
  VIEWED
  ACCEPTED
  EXPIRED
  CANCELLED
}

enum PaymentMethod {
  RAZORPAY_UPI
  RAZORPAY_CARD
  RAZORPAY_NETBANKING
  RAZORPAY_WALLET
  BANK_TRANSFER
  CASH
  CHEQUE
}

enum PaymentPlan {
  FULL
  QUARTERLY
  MONTHLY
  CUSTOM
}

enum PaymentStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  CANCELLED
  REFUNDED
}

enum PaymentStatusEnum {
  PENDING
  PAID
  OVERDUE
  FAILED
}

enum PlaybackPolicy {
  PUBLIC
  SIGNED_URL
  TOKEN_AUTH
}

enum PostType {
  QUESTION
  DISCUSSION
  TIP
  RESOURCE
  ANNOUNCEMENT
}

enum Priority {
  HOT
  WARM
  COLD
}

enum ProgressStatus {
  NOT_STARTED
  VIEWED
  IN_PROGRESS
  DOWNLOADED
  COMPLETED
}

enum QuestionBankCategory {
  NEET_PREVIOUS_YEAR
  CBSE_BOARD
  NCERT_BASED
  COMPETITIVE
  CONCEPT_BUILDER
  CUSTOM
  PRACTICE_SET
}

enum QuestionCategory {
  PRACTICE
  MOCK_TEST
  PREVIOUS_YEAR
  CONCEPT_BUILDER
  COMPETITIVE
}

enum QuestionSourceType {
  QUESTION_BANK
  AI_GENERATED
  MANUAL
  TEMPLATE
}

enum QuestionType {
  MCQ
  SHORT_ANSWER
  DIAGRAM
  TRUE_FALSE
  FILL_BLANK
  MULTIPLE_SELECT
  MATCH_FOLLOWING
  NUMERICAL
  ASSERTION_REASON
  STATEMENT_BASED
  COUNTING_TYPE
  SEQUENCE_ORDER
  MTF
  DATA_INTERPRETATION
  EXPERIMENTAL_DESIGN
}

enum QueueStatus {
  PENDING
  PROCESSING
  COMPLETED
  FAILED
  SKIPPED
  CANCELLED
}

enum QuizFormat {
  MODERATOR
  TEAMS_ASK_EACH_OTHER
}

enum QuizQuestionMode {
  SIMPLE_SCOREBOARD
  PRELOADED
}

enum QuizSessionStatus {
  WAITING
  IN_PROGRESS
  PAUSED
  COMPLETED
}

enum QuizTeam {
  TEAM_A
  TEAM_B
}

enum QuizWinner {
  TEAM_A
  TEAM_B
  TIE
}

enum ReportType {
  DAILY
  WEEKLY
  MONTHLY
  QUARTERLY
  CUSTOM
}

enum ResponseMode {
  TEST_MODE
  PRACTICE_MODE
  REVIEW_MODE
  STUDY_MODE
}

enum RoundOutcome {
  CORRECT
  INCORRECT
  PASSED
  PARTIAL
  SKIPPED
}

enum SecurityAuditEventType {
  login
  logout
  admin_access
  failed_login
  rate_limit_exceeded
  password_change
  account_locked
  suspicious_activity
  data_access
  data_modification
  permission_change
}

enum SecurityAuditSeverity {
  low
  medium
  high
  critical
}

enum SecuritySeverity {
  LOW
  MEDIUM
  HIGH
  CRITICAL
}

enum SeminarPaymentStatus {
  PENDING
  COMPLETED
  FAILED
  REFUNDED
}

enum SeminarPricingTier {
  EARLY_BIRD
  STANDARD
  PREMIUM
}

enum SessionStatus {
  SCHEDULED
  ONGOING
  COMPLETED
  CANCELLED
  RESCHEDULED
}

enum SessionType {
  REGULAR
  DOUBT_CLEARING
  REVISION
  TEST
  PRACTICAL
  WORKSHOP
  SEMINAR
  GUEST_LECTURE
  EXTRA_CLASS
}

enum ShowResultsType {
  IMMEDIATELY
  AFTER_DEADLINE
  MANUAL_RELEASE
  NEVER
}

enum StudentClass {
  CLASS_9
  CLASS_10
  CLASS_11
  CLASS_12
  DROPPER
  FOUNDATION
}

enum SubmissionStatus {
  NOT_SUBMITTED
  SUBMITTED
  LATE
  GRADED
  RESUBMIT_REQUIRED
}

enum SubmissionTestStatus {
  NOT_STARTED
  IN_PROGRESS
  PAUSED
  SUBMITTED
  GRADED
}

enum TaskPriority {
  HIGH
  MEDIUM
  LOW
}

enum TaskStatus {
  PENDING
  IN_PROGRESS
  COMPLETED
  SNOOZED
  CANCELLED
}

enum TaskType {
  FOLLOW_UP_CALL
  SEND_WHATSAPP
  SEND_EMAIL
  PAYMENT_REMINDER
  DEMO_FOLLOWUP
  CUSTOM
}

enum TestAssignmentStatus {
  DRAFT
  PUBLISHED
  ACTIVE
  COMPLETED
  ARCHIVED
}

enum TestCategory {
  TOPIC_WISE
  SUBJECT_WISE
  FULL_SYLLABUS
  CHAPTER_WISE
  DIFFICULTY_WISE
  PREVIOUS_YEAR
  MIXED
}

enum TestSessionStatus {
  NOT_STARTED
  IN_PROGRESS
  PAUSED
  COMPLETED
  EXPIRED
  ABANDONED
  TERMINATED
}

enum TestStatus {
  IN_PROGRESS
  COMPLETED
  ABANDONED
  EXPIRED
}

enum TestType {
  PRACTICE_TEST
  MOCK_TEST
  FULL_TEST
  QUICK_TEST
  ADAPTIVE_TEST
  TIMED_TEST
  DIAGNOSTIC_TEST
}

enum UserRole {
  STUDENT
  PARENT
  TEACHER
  ADMIN
  COUNSELOR
}

enum VideoUploadStatus {
  PENDING
  UPLOADING
  PROCESSING
  READY
  FAILED
  DELETED
}

// Web Vitals Monitoring
model WebVital {
  id          String   @id @default(cuid())
  metricName  String // LCP, FCP, CLS, INP, TTFB
  metricValue Float
  rating      String // good, needs-improvement, poor
  page        String
  metricId    String
  delta       Float
  connection  String?
  userAgent   String?
  country     String?
  createdAt   DateTime @default(now())

  @@index([metricName])
  @@index([page])
  @@index([createdAt])
  @@index([rating])
}

// WhatsApp Nurturing Sequences
model whatsapp_nurturing {
  id            String    @id
  phone         String
  name          String
  leadId        String
  source        String
  status        String    @default("ACTIVE") // ACTIVE, COMPLETED, STOPPED
  currentStep   Int       @default(1)
  totalSteps    Int       @default(4)
  nextMessageAt DateTime?
  createdAt     DateTime  @default(now())
  updatedAt     DateTime

  @@index([phone])
  @@index([status])
  @@index([nextMessageAt])
}
